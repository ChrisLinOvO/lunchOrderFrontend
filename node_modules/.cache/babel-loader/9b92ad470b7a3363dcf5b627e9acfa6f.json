{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _util = require(\"./util\");\n\nvar _messages2 = _interopRequireDefault(require(\"./messages\"));\n\nvar _validator = require(\"./validator\");\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        (0, _defineProperty2.default)(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}\n\nfunction noop() {}\n\nfunction serializeRules(source, rules) {\n  // serialize rules\n  var arr;\n  var value;\n  var series = {};\n  var names = Object.keys(rules);\n  names.forEach(function (name) {\n    arr = rules[name];\n    value = source[name];\n\n    if (!Array.isArray(arr)) {\n      arr = [arr];\n    }\n\n    arr.forEach(function (rule) {\n      rule.validator = (0, _validator.getValidationMethod)(rule);\n      rule.field = name;\n\n      if (!rule.validator) {\n        return;\n      }\n\n      series[name] = series[name] || [];\n      series[name].push({\n        rule: rule,\n        value: value,\n        source: source,\n        field: name\n      });\n    });\n  });\n  return series;\n}\n\nvar Schema = /*#__PURE__*/function () {\n  function Schema(rules) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    (0, _classCallCheck2.default)(this, Schema);\n    this._rules = rules;\n    this._options = _objectSpread(_objectSpread({}, options), {}, {\n      messages: _objectSpread(_objectSpread({}, _messages2.default), options.messages)\n    });\n    this.complete = [];\n  }\n\n  (0, _createClass2.default)(Schema, [{\n    key: \"abort\",\n    value: function abort() {\n      for (var i = 0; i < this.complete.length; i++) {\n        this.complete[i] = noop;\n      }\n    }\n  }, {\n    key: \"messages\",\n    value: function messages(_messages) {\n      this._options.messages = Object.assign({}, this._options.messages, _messages);\n    }\n    /**\n     *\n     * @param {Object} source - map of field names and values to use in validation\n     * @param {Function} callback - OPTIONAL - callback to run after all\n     * @returns {null | Promise}\n     *          - { null } - if using callbacks\n     *          - { Promise }\n     *              - { errors: null } - if no rules or no errors\n     *              - { errors: Array, fields: Object } - errors from validation and fields that have errors\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(source, callback) {\n      var _this = this;\n\n      if (!callback) {\n        return this.validatePromise(source);\n      }\n\n      if (!this._rules || Object.keys(this._rules).length === 0) {\n        if (callback) {\n          callback(null);\n        }\n\n        return;\n      }\n\n      var series = serializeRules(source, this._rules);\n\n      if (Object.keys(series).length === 0) {\n        callback(null);\n      } // callback function for all rules return\n\n\n      function complete(results) {\n        var i;\n        var field;\n        var errors = [];\n        var fields = {};\n\n        function add(e) {\n          if (Array.isArray(e)) {\n            errors = errors.concat(e);\n          } else {\n            errors.push(e);\n          }\n        }\n\n        for (i = 0; i < results.length; i++) {\n          add(results[i]);\n        }\n\n        if (!errors.length) {\n          errors = null;\n          fields = null;\n        } else {\n          for (i = 0; i < errors.length; i++) {\n            field = errors[i].field;\n            fields[field] = fields[field] || [];\n            fields[field].push(errors[i]);\n          }\n        }\n\n        callback(errors, fields);\n      }\n\n      this.complete.push(complete);\n      var idx = this.complete.length; // async validate\n\n      (0, _util.asyncMap)(series, this._options, function (data, doIt) {\n        var rule = data.rule;\n        rule.field = data.field;\n\n        function cb(e) {\n          var errors = e; // fix e=/\"\"/null/undefiend.\n          // ignore e=true/false;\n\n          if (typeof errors !== 'boolean' && !errors) {\n            errors = [];\n          }\n\n          if (!Array.isArray(errors)) {\n            errors = [errors];\n          } // 自定义错误\n\n\n          if (errors.length && rule.message) {\n            errors = [].concat(rule.message);\n          }\n\n          errors = errors.map((0, _util.complementError)(rule));\n          doIt(errors);\n        }\n\n        var res = rule.validator(rule, data.value, cb, _this._options);\n\n        if (res && res.then) {\n          res.then(function () {\n            return cb();\n          }, function (e) {\n            return cb(e);\n          });\n        }\n      }, function (results) {\n        _this.complete[idx - 1](results);\n      });\n    }\n    /**\n     *\n     * @param {Object} source - map of field names and values to use in validation\n     * @returns {Promise}\n     *          - { errors: null } if no rules or no errors\n     *          - { errors: Array, fields: Object } - errors from validation and fields that have errors\n     */\n\n  }, {\n    key: \"validatePromise\",\n    value: function () {\n      var _validatePromise = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(source) {\n        var _this2 = this;\n\n        var series, results;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(!this._rules || Object.keys(this._rules).length === 0)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", Promise.resolve({\n                  errors: null\n                }));\n\n              case 2:\n                series = serializeRules(source, this._rules);\n\n                if (!(Object.keys(series).length === 0)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", Promise.resolve({\n                  errors: null\n                }));\n\n              case 5:\n                _context2.next = 7;\n                return (0, _util.asyncMapPromise)(series, this._options, /*#__PURE__*/function () {\n                  var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(data) {\n                    var rule, errors;\n                    return _regenerator.default.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            rule = data.rule;\n                            rule.field = data.field;\n                            _context.prev = 2;\n                            _context.next = 5;\n                            return rule.validator(rule, data.value, null, _this2._options);\n\n                          case 5:\n                            errors = _context.sent;\n                            _context.next = 11;\n                            break;\n\n                          case 8:\n                            _context.prev = 8;\n                            _context.t0 = _context[\"catch\"](2);\n                            errors = _context.t0;\n\n                          case 11:\n                            if (!errors) {\n                              _context.next = 17;\n                              break;\n                            }\n\n                            if (!Array.isArray(errors)) {\n                              errors = [errors];\n                            } // 自定义错误\n\n\n                            if (errors.length && rule.message) {\n                              errors = [].concat(rule.message);\n                            }\n\n                            return _context.abrupt(\"return\", errors.map((0, _util.complementError)(rule)));\n\n                          case 17:\n                            return _context.abrupt(\"return\", []);\n\n                          case 18:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, null, [[2, 8]]);\n                  }));\n\n                  return function (_x2) {\n                    return _ref.apply(this, arguments);\n                  };\n                }());\n\n              case 7:\n                results = _context2.sent;\n                return _context2.abrupt(\"return\", (0, _util.processErrorResults)(results));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function validatePromise(_x) {\n        return _validatePromise.apply(this, arguments);\n      }\n\n      return validatePromise;\n    }()\n  }]);\n  return Schema;\n}();\n\nvar _default = Schema;\nexports.default = _default;","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/node_modules/@alifd/validate/lib/index.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","default","_regenerator","_asyncToGenerator2","_defineProperty2","_classCallCheck2","_createClass2","_util","_messages2","_validator","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","forEach","key","getOwnPropertyDescriptors","defineProperties","noop","serializeRules","rules","arr","series","names","name","Array","isArray","rule","validator","getValidationMethod","field","Schema","options","undefined","_rules","_options","messages","complete","abort","_messages","assign","validate","callback","_this","validatePromise","results","errors","fields","add","e","concat","idx","asyncMap","data","doIt","cb","message","map","complementError","res","then","_validatePromise","mark","_callee2","_this2","wrap","_callee2$","_context2","prev","next","abrupt","Promise","resolve","asyncMapPromise","_ref","_callee","_callee$","_context","sent","t0","stop","_x2","processErrorResults","_x","_default"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.default = void 0;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar _defineProperty2 = _interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));\n\nvar _classCallCheck2 = _interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));\n\nvar _createClass2 = _interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));\n\nvar _util = require(\"./util\");\n\nvar _messages2 = _interopRequireDefault(require(\"./messages\"));\n\nvar _validator = require(\"./validator\");\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { (0, _defineProperty2.default)(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction noop() {}\n\nfunction serializeRules(source, rules) {\n  // serialize rules\n  var arr;\n  var value;\n  var series = {};\n  var names = Object.keys(rules);\n  names.forEach(function (name) {\n    arr = rules[name];\n    value = source[name];\n\n    if (!Array.isArray(arr)) {\n      arr = [arr];\n    }\n\n    arr.forEach(function (rule) {\n      rule.validator = (0, _validator.getValidationMethod)(rule);\n      rule.field = name;\n\n      if (!rule.validator) {\n        return;\n      }\n\n      series[name] = series[name] || [];\n      series[name].push({\n        rule: rule,\n        value: value,\n        source: source,\n        field: name\n      });\n    });\n  });\n  return series;\n}\n\nvar Schema = /*#__PURE__*/function () {\n  function Schema(rules) {\n    var options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    (0, _classCallCheck2.default)(this, Schema);\n    this._rules = rules;\n    this._options = _objectSpread(_objectSpread({}, options), {}, {\n      messages: _objectSpread(_objectSpread({}, _messages2.default), options.messages)\n    });\n    this.complete = [];\n  }\n\n  (0, _createClass2.default)(Schema, [{\n    key: \"abort\",\n    value: function abort() {\n      for (var i = 0; i < this.complete.length; i++) {\n        this.complete[i] = noop;\n      }\n    }\n  }, {\n    key: \"messages\",\n    value: function messages(_messages) {\n      this._options.messages = Object.assign({}, this._options.messages, _messages);\n    }\n    /**\n     *\n     * @param {Object} source - map of field names and values to use in validation\n     * @param {Function} callback - OPTIONAL - callback to run after all\n     * @returns {null | Promise}\n     *          - { null } - if using callbacks\n     *          - { Promise }\n     *              - { errors: null } - if no rules or no errors\n     *              - { errors: Array, fields: Object } - errors from validation and fields that have errors\n     */\n\n  }, {\n    key: \"validate\",\n    value: function validate(source, callback) {\n      var _this = this;\n\n      if (!callback) {\n        return this.validatePromise(source);\n      }\n\n      if (!this._rules || Object.keys(this._rules).length === 0) {\n        if (callback) {\n          callback(null);\n        }\n\n        return;\n      }\n\n      var series = serializeRules(source, this._rules);\n\n      if (Object.keys(series).length === 0) {\n        callback(null);\n      } // callback function for all rules return\n\n\n      function complete(results) {\n        var i;\n        var field;\n        var errors = [];\n        var fields = {};\n\n        function add(e) {\n          if (Array.isArray(e)) {\n            errors = errors.concat(e);\n          } else {\n            errors.push(e);\n          }\n        }\n\n        for (i = 0; i < results.length; i++) {\n          add(results[i]);\n        }\n\n        if (!errors.length) {\n          errors = null;\n          fields = null;\n        } else {\n          for (i = 0; i < errors.length; i++) {\n            field = errors[i].field;\n            fields[field] = fields[field] || [];\n            fields[field].push(errors[i]);\n          }\n        }\n\n        callback(errors, fields);\n      }\n\n      this.complete.push(complete);\n      var idx = this.complete.length; // async validate\n\n      (0, _util.asyncMap)(series, this._options, function (data, doIt) {\n        var rule = data.rule;\n        rule.field = data.field;\n\n        function cb(e) {\n          var errors = e; // fix e=/\"\"/null/undefiend.\n          // ignore e=true/false;\n\n          if (typeof errors !== 'boolean' && !errors) {\n            errors = [];\n          }\n\n          if (!Array.isArray(errors)) {\n            errors = [errors];\n          } // 自定义错误\n\n\n          if (errors.length && rule.message) {\n            errors = [].concat(rule.message);\n          }\n\n          errors = errors.map((0, _util.complementError)(rule));\n          doIt(errors);\n        }\n\n        var res = rule.validator(rule, data.value, cb, _this._options);\n\n        if (res && res.then) {\n          res.then(function () {\n            return cb();\n          }, function (e) {\n            return cb(e);\n          });\n        }\n      }, function (results) {\n        _this.complete[idx - 1](results);\n      });\n    }\n    /**\n     *\n     * @param {Object} source - map of field names and values to use in validation\n     * @returns {Promise}\n     *          - { errors: null } if no rules or no errors\n     *          - { errors: Array, fields: Object } - errors from validation and fields that have errors\n     */\n\n  }, {\n    key: \"validatePromise\",\n    value: function () {\n      var _validatePromise = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(source) {\n        var _this2 = this;\n\n        var series, results;\n        return _regenerator.default.wrap(function _callee2$(_context2) {\n          while (1) {\n            switch (_context2.prev = _context2.next) {\n              case 0:\n                if (!(!this._rules || Object.keys(this._rules).length === 0)) {\n                  _context2.next = 2;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", Promise.resolve({\n                  errors: null\n                }));\n\n              case 2:\n                series = serializeRules(source, this._rules);\n\n                if (!(Object.keys(series).length === 0)) {\n                  _context2.next = 5;\n                  break;\n                }\n\n                return _context2.abrupt(\"return\", Promise.resolve({\n                  errors: null\n                }));\n\n              case 5:\n                _context2.next = 7;\n                return (0, _util.asyncMapPromise)(series, this._options, /*#__PURE__*/function () {\n                  var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(data) {\n                    var rule, errors;\n                    return _regenerator.default.wrap(function _callee$(_context) {\n                      while (1) {\n                        switch (_context.prev = _context.next) {\n                          case 0:\n                            rule = data.rule;\n                            rule.field = data.field;\n                            _context.prev = 2;\n                            _context.next = 5;\n                            return rule.validator(rule, data.value, null, _this2._options);\n\n                          case 5:\n                            errors = _context.sent;\n                            _context.next = 11;\n                            break;\n\n                          case 8:\n                            _context.prev = 8;\n                            _context.t0 = _context[\"catch\"](2);\n                            errors = _context.t0;\n\n                          case 11:\n                            if (!errors) {\n                              _context.next = 17;\n                              break;\n                            }\n\n                            if (!Array.isArray(errors)) {\n                              errors = [errors];\n                            } // 自定义错误\n\n\n                            if (errors.length && rule.message) {\n                              errors = [].concat(rule.message);\n                            }\n\n                            return _context.abrupt(\"return\", errors.map((0, _util.complementError)(rule)));\n\n                          case 17:\n                            return _context.abrupt(\"return\", []);\n\n                          case 18:\n                          case \"end\":\n                            return _context.stop();\n                        }\n                      }\n                    }, _callee, null, [[2, 8]]);\n                  }));\n\n                  return function (_x2) {\n                    return _ref.apply(this, arguments);\n                  };\n                }());\n\n              case 7:\n                results = _context2.sent;\n                return _context2.abrupt(\"return\", (0, _util.processErrorResults)(results));\n\n              case 9:\n              case \"end\":\n                return _context2.stop();\n            }\n          }\n        }, _callee2, this);\n      }));\n\n      function validatePromise(_x) {\n        return _validatePromise.apply(this, arguments);\n      }\n\n      return validatePromise;\n    }()\n  }]);\n  return Schema;\n}();\n\nvar _default = Schema;\nexports.default = _default;"]},"metadata":{},"sourceType":"script"}