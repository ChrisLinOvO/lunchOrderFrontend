{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp;\n\nimport React, { Children, Component } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport { polyfill } from 'react-lifecycles-compat';\nimport { dom, events, focus, func, guid, KEYCODE, support } from '../util';\nimport overlayManager from './manager';\nimport Gateway from './gateway';\nimport Position from './position';\nimport findNode from './utils/find-node';\nvar saveLastFocusNode = focus.saveLastFocusNode,\n    getFocusNodeList = focus.getFocusNodeList,\n    backLastFocusNode = focus.backLastFocusNode;\nvar makeChain = func.makeChain,\n    noop = func.noop,\n    bindCtx = func.bindCtx;\n\nvar isScrollDisplay = function isScrollDisplay(element) {\n  try {\n    var scrollbarStyle = window.getComputedStyle(element, '::-webkit-scrollbar');\n    return !scrollbarStyle || scrollbarStyle.getPropertyValue('display') !== 'none';\n  } catch (e) {// ignore error for firefox\n  }\n\n  return true;\n};\n\nvar hasScroll = function hasScroll(containerNode) {\n  var parentNode = containerNode.parentNode;\n  return parentNode && parentNode.scrollHeight > parentNode.clientHeight && dom.scrollbar().width > 0 && isScrollDisplay(parentNode) && isScrollDisplay(containerNode);\n};\n\nvar getContainerNode = function getContainerNode(props) {\n  var targetNode = findNode(props.target);\n  return findNode(props.container, targetNode);\n};\n\nvar prefixes = ['-webkit-', '-moz-', '-o-', 'ms-', ''];\n\nvar getStyleProperty = function getStyleProperty(node, name) {\n  var style = window.getComputedStyle(node);\n  var ret = '';\n\n  for (var i = 0; i < prefixes.length; i++) {\n    ret = style.getPropertyValue(prefixes[i] + name);\n\n    if (ret) {\n      break;\n    }\n  }\n\n  return ret;\n}; // 存 containerNode 信息\n\n\nvar containerNodeList = [];\n/**\n * Overlay\n */\n\nvar Overlay = (_temp = _class = function (_Component) {\n  _inherits(Overlay, _Component);\n\n  function Overlay(props) {\n    _classCallCheck(this, Overlay);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n    _this.saveContentRef = function (ref) {\n      _this.contentRef = ref;\n    };\n\n    _this.saveGatewayRef = function (ref) {\n      _this.gatewayRef = ref;\n    };\n\n    _this.lastAlign = props.align;\n    bindCtx(_this, ['handlePosition', 'handleAnimateEnd', 'handleDocumentKeyDown', 'handleDocumentClick', 'handleMaskClick', 'beforeOpen', 'beforeClose']);\n    _this.state = {\n      visible: false,\n      status: 'none',\n      animation: _this.getAnimation(props),\n      willOpen: false,\n      willClose: false\n    };\n    _this.timeoutMap = {};\n    return _this;\n  }\n\n  Overlay.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n    var willOpen = !prevState.visible && nextProps.visible;\n    var willClose = prevState.visible && !nextProps.visible;\n    var nextState = {\n      willOpen: willOpen,\n      willClose: willClose\n    };\n\n    if (willOpen) {\n      nextProps.beforeOpen && nextProps.beforeOpen();\n    } else if (willClose) {\n      nextProps.beforeClose && nextProps.beforeClose();\n    }\n\n    if (nextProps.animation || nextProps.animation === false) {\n      nextState.animation = nextProps.animation;\n    }\n\n    if (nextProps.animation !== false && support.animation) {\n      if (willOpen) {\n        nextState.visible = true;\n        nextState.status = 'mounting';\n      } else if (willClose) {\n        // can not set visible=false directly, otherwise animation not work without dom\n        // nextState.visible = false;\n        nextState.status = 'leaving';\n      }\n    } else if ('visible' in nextProps && nextProps.visible !== prevState.visible) {\n      nextState.visible = nextProps.visible;\n    }\n\n    return nextState;\n  };\n\n  Overlay.prototype.componentDidMount = function componentDidMount() {\n    if (this.state.willOpen) {\n      this.beforeOpen();\n    } else if (this.state.willClose) {\n      this.beforeClose();\n    }\n\n    if (this.state.visible) {\n      this.doAnimation(true, false);\n      this._isMounted = true;\n    }\n\n    this.addDocumentEvents();\n    overlayManager.addOverlay(this);\n  };\n\n  Overlay.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n    if (this.state.willOpen) {\n      this.beforeOpen();\n    } else if (this.state.willClose) {\n      this.beforeClose();\n    }\n\n    if (!this._isMounted && this.props.visible) {\n      this._isMounted = true;\n    }\n\n    if (this.props.align !== prevProps.align) {\n      this.lastAlign = prevProps.align;\n    }\n\n    var willOpen = !prevProps.visible && this.props.visible;\n    var willClose = prevProps.visible && !this.props.visible;\n    (willOpen || willClose) && this.doAnimation(willOpen, willClose);\n  };\n\n  Overlay.prototype.componentWillUnmount = function componentWillUnmount() {\n    this._isDestroyed = true;\n    this._isMounted = false;\n    overlayManager.removeOverlay(this);\n    this.removeDocumentEvents();\n\n    if (this.focusTimeout) {\n      clearTimeout(this.focusTimeout);\n    }\n\n    if (this._animation) {\n      this._animation.off();\n\n      this._animation = null;\n    }\n\n    this.beforeClose();\n  };\n\n  Overlay.prototype.doAnimation = function doAnimation(open, close) {\n    var _this2 = this;\n\n    if (this.state.animation && support.animation) {\n      if (open) {\n        this.onEntering();\n      } else if (close) {\n        this.onLeaving();\n      }\n\n      this.addAnimationEvents();\n    } else {\n      if (open) {\n        // fix https://github.com/alibaba-fusion/next/issues/1901\n        setTimeout(function () {\n          _this2.props.onOpen();\n\n          dom.addClass(_this2.getWrapperNode(), 'opened');\n          overlayManager.addOverlay(_this2);\n\n          _this2.props.afterOpen();\n        });\n      } else if (close) {\n        this.props.onClose();\n        dom.removeClass(this.getWrapperNode(), 'opened');\n        overlayManager.removeOverlay(this);\n        this.props.afterClose();\n      }\n\n      this.setFocusNode();\n    }\n  };\n\n  Overlay.prototype.getAnimation = function getAnimation(props) {\n    if (props.animation === false) {\n      return false;\n    }\n\n    if (props.animation) {\n      return props.animation;\n    }\n\n    return this.getAnimationByAlign(props.align);\n  };\n\n  Overlay.prototype.getAnimationByAlign = function getAnimationByAlign(align) {\n    switch (align[0]) {\n      case 't':\n        return {\n          // 为了防止有的用户 js升级了而css没升级，所以把两个动画都保留了。\n          // 动画不会叠加，会替代，顺序根据 src/animate/main.scss 中的样式先后顺序遵循css覆盖原则\n          // fadeInDownSmall fadeOutUpSmall 优先级更高\n          in: 'expandInDown fadeInDownSmall',\n          out: 'expandOutUp fadeOutUpSmall'\n        };\n\n      case 'b':\n        return {\n          in: 'fadeInUp',\n          out: 'fadeOutDown'\n        };\n\n      default:\n        return {\n          in: 'expandInDown fadeInDownSmall',\n          out: 'expandOutUp fadeOutUpSmall'\n        };\n    }\n  };\n\n  Overlay.prototype.addAnimationEvents = function addAnimationEvents() {\n    var _this3 = this;\n\n    setTimeout(function () {\n      var node = _this3.getContentNode();\n\n      if (node) {\n        var id = guid();\n        _this3._animation = events.on(node, support.animation.end, _this3.handleAnimateEnd.bind(_this3, id));\n        var animationDelay = parseFloat(getStyleProperty(node, 'animation-delay')) || 0;\n        var animationDuration = parseFloat(getStyleProperty(node, 'animation-duration')) || 0;\n        var time = animationDelay + animationDuration;\n\n        if (time) {\n          _this3.timeoutMap[id] = setTimeout(function () {\n            _this3.handleAnimateEnd(id);\n          }, time * 1000 + 200);\n        }\n      }\n    });\n  };\n\n  Overlay.prototype.handlePosition = function handlePosition(config) {\n    var align = config.align.join(' ');\n\n    if (!('animation' in this.props) && this.props.needAdjust && this.lastAlign !== align) {\n      this.setState({\n        animation: this.getAnimationByAlign(align)\n      });\n    }\n\n    var status = this.state.status;\n\n    if (status === 'mounting') {\n      this.setState({\n        status: 'entering'\n      });\n    }\n\n    this.lastAlign = align;\n  };\n\n  Overlay.prototype.handleAnimateEnd = function handleAnimateEnd(id) {\n    if (this.timeoutMap[id]) {\n      clearTimeout(this.timeoutMap[id]);\n    }\n\n    delete this.timeoutMap[id];\n\n    if (this._animation) {\n      this._animation.off();\n\n      this._animation = null;\n    }\n\n    if (!this._isMounted) {\n      return;\n    }\n\n    if (this.state.status === 'leaving') {\n      this.setState({\n        visible: false,\n        status: 'none'\n      });\n      this.onLeaved(); // dom结构首次出现 触发的是entering\n      // dom结构已经存在（例如设置了cache），触发的是mounting\n    } else if (this.state.status === 'entering' || this.state.status === 'mounting') {\n      this.setState({\n        status: 'none'\n      });\n      this.onEntered();\n    }\n  };\n\n  Overlay.prototype.onEntering = function onEntering() {\n    var _this4 = this;\n\n    if (this._isDestroyed) {\n      return;\n    } // make sure overlay.ref has been called (eg: menu/popup-item called overlay.getInstance().getContentNode().)\n\n\n    setTimeout(function () {\n      var wrapperNode = _this4.getWrapperNode();\n\n      dom.addClass(wrapperNode, 'opened');\n\n      _this4.props.onOpen();\n    });\n  };\n\n  Overlay.prototype.onLeaving = function onLeaving() {\n    var wrapperNode = this.getWrapperNode();\n    dom.removeClass(wrapperNode, 'opened');\n    this.props.onClose();\n  };\n\n  Overlay.prototype.onEntered = function onEntered() {\n    overlayManager.addOverlay(this);\n    this.setFocusNode();\n    this.props.afterOpen();\n  };\n\n  Overlay.prototype.onLeaved = function onLeaved() {\n    overlayManager.removeOverlay(this);\n    this.setFocusNode();\n    this.props.afterClose();\n  };\n\n  Overlay.prototype.beforeOpen = function beforeOpen() {\n    if (this.props.disableScroll) {\n      var containerNode = getContainerNode(this.props) || document.body;\n      var _containerNode$style = containerNode.style,\n          overflow = _containerNode$style.overflow,\n          paddingRight = _containerNode$style.paddingRight;\n      var cnInfo = containerNodeList.find(function (m) {\n        return m.containerNode === containerNode;\n      }) || {\n        containerNode: containerNode,\n        count: 0\n      };\n      /**\n       * container 节点初始状态已经是 overflow=hidden 则忽略\n       * See {@link https://codesandbox.io/s/next-overlay-overflow-2-fulpq?file=/src/App.js}\n       */\n\n      if (cnInfo.count === 0 && overflow !== 'hidden') {\n        var style = {\n          overflow: 'hidden'\n        };\n        cnInfo.overflow = overflow;\n\n        if (hasScroll(containerNode)) {\n          cnInfo.paddingRight = paddingRight;\n          style.paddingRight = dom.getStyle(containerNode, 'paddingRight') + dom.scrollbar().width + 'px';\n        }\n\n        dom.setStyle(containerNode, style);\n        containerNodeList.push(cnInfo);\n        cnInfo.count++;\n      } else if (cnInfo.count) {\n        cnInfo.count++;\n      }\n\n      this._containerNode = containerNode;\n    }\n  };\n\n  Overlay.prototype.beforeClose = function beforeClose() {\n    var _this5 = this;\n\n    if (this.props.disableScroll) {\n      var idx = containerNodeList.findIndex(function (cn) {\n        return cn.containerNode === _this5._containerNode;\n      });\n\n      if (idx !== -1) {\n        var cnInfo = containerNodeList[idx];\n        var overflow = cnInfo.overflow,\n            paddingRight = cnInfo.paddingRight; // 最后一个 overlay 的时候再将样式重置回去\n        // 此时 overflow 应该值在 beforeOpen 中设置的 hidden\n\n        if (cnInfo.count === 1 && this._containerNode && this._containerNode.style.overflow === 'hidden') {\n          var style = {\n            overflow: overflow\n          };\n\n          if (paddingRight !== undefined) {\n            style.paddingRight = paddingRight;\n          }\n\n          dom.setStyle(this._containerNode, style);\n        }\n\n        cnInfo.count--;\n\n        if (cnInfo.count === 0) {\n          containerNodeList.splice(idx, 1);\n        }\n      }\n\n      this._containerNode = undefined;\n    }\n  };\n\n  Overlay.prototype.setFocusNode = function setFocusNode() {\n    var _this6 = this;\n\n    if (!this.props.autoFocus) {\n      return;\n    }\n\n    if (this.state.visible && !this._hasFocused) {\n      saveLastFocusNode(); // 这个时候很可能上一个弹层的关闭事件还未触发，导致焦点已经回到触发的元素\n      // 这里延时处理一下，延时的时间为 document.click 捕获触发的延时时间\n\n      this.focusTimeout = setTimeout(function () {\n        var node = _this6.getContentNode();\n\n        if (node) {\n          var focusNodeList = getFocusNodeList(node);\n\n          if (focusNodeList.length) {\n            focusNodeList[0].focus();\n          }\n\n          _this6._hasFocused = true;\n        }\n      }, 100);\n    } else if (!this.state.visible && this._hasFocused) {\n      backLastFocusNode();\n      this._hasFocused = false;\n    }\n  };\n\n  Overlay.prototype.getContent = function getContent() {\n    return this.contentRef;\n  };\n\n  Overlay.prototype.getContentNode = function getContentNode() {\n    try {\n      return findDOMNode(this.contentRef);\n    } catch (err) {\n      return null;\n    }\n  };\n\n  Overlay.prototype.getWrapperNode = function getWrapperNode() {\n    return this.gatewayRef ? this.gatewayRef.getChildNode() : null;\n  };\n  /**\n   * document global event\n   */\n\n\n  Overlay.prototype.addDocumentEvents = function addDocumentEvents() {\n    if (this.props.canCloseByEsc) {\n      this._keydownEvents = events.on(document, 'keydown', this.handleDocumentKeyDown);\n    }\n\n    if (this.props.canCloseByOutSideClick) {\n      this._clickEvents = events.on(document, 'click', this.handleDocumentClick);\n      this._touchEvents = events.on(document, 'touchend', this.handleDocumentClick);\n    }\n  };\n\n  Overlay.prototype.removeDocumentEvents = function removeDocumentEvents() {\n    var _this7 = this;\n\n    ['_keydownEvents', '_clickEvents', '_touchEvents'].forEach(function (event) {\n      if (_this7[event]) {\n        _this7[event].off();\n\n        _this7[event] = null;\n      }\n    });\n  };\n\n  Overlay.prototype.handleDocumentKeyDown = function handleDocumentKeyDown(e) {\n    if (this.state.visible && e.keyCode === KEYCODE.ESC && overlayManager.isCurrentOverlay(this)) {\n      this.props.onRequestClose('keyboard', e);\n    }\n  };\n\n  Overlay.prototype.isInShadowDOM = function isInShadowDOM(node) {\n    return node.getRootNode ? node.getRootNode().nodeType === 11 : false;\n  };\n\n  Overlay.prototype.getEventPath = function getEventPath(event) {\n    // 参考 https://github.com/spring-media/react-shadow-dom-retarget-events/blob/master/index.js#L29\n    return event.path || event.composedPath && event.composedPath() || this.composedPath(event.target);\n  };\n\n  Overlay.prototype.composedPath = function composedPath(el) {\n    var path = [];\n\n    while (el) {\n      path.push(el);\n\n      if (el.tagName === 'HTML') {\n        path.push(document);\n        path.push(window);\n        return path;\n      }\n\n      el = el.parentElement;\n    }\n  };\n\n  Overlay.prototype.matchInShadowDOM = function matchInShadowDOM(node, e) {\n    if (this.isInShadowDOM(node)) {\n      // Shadow DOM 环境中，触发点击事件，监听 document click 事件获得的事件源\n      // 并非实际触发的 dom 节点，而是 Shadow DOM 的 host 节点\n      // 进而会导致如 Select 组件的下拉弹层打开后立即关闭等问题\n      // 因此额外增加 node 和 eventPath 的判断\n      var eventPath = this.getEventPath(e);\n      return node === eventPath[0] || node.contains(eventPath[0]);\n    }\n\n    return false;\n  };\n\n  Overlay.prototype.handleDocumentClick = function handleDocumentClick(e) {\n    var _this8 = this;\n\n    if (this.state.visible) {\n      var safeNode = this.props.safeNode;\n      var safeNodes = Array.isArray(safeNode) ? [].concat(safeNode) : [safeNode];\n      safeNodes.unshift(function () {\n        return _this8.getWrapperNode();\n      });\n\n      for (var i = 0; i < safeNodes.length; i++) {\n        var node = findNode(safeNodes[i], this.props); // HACK: 如果触发点击的节点是弹层内部的节点，并且在被点击后立即销毁，那么此时无法使用 node.contains(e.target)\n        // 来判断此时点击的节点是否是弹层内部的节点，额外判断\n\n        if (node && (node === e.target || node.contains(e.target) || this.matchInShadowDOM(node, e) || e.target !== document && !document.documentElement.contains(e.target))) {\n          return;\n        }\n      }\n\n      this.props.onRequestClose('docClick', e);\n    }\n  };\n\n  Overlay.prototype.handleMaskClick = function handleMaskClick(e) {\n    if (e.currentTarget === e.target && this.props.canCloseByMask) {\n      this.props.onRequestClose('maskClick', e);\n    }\n  }; // 兼容过去的用法: this.popupRef.getInstance().overlay.getInstance().getContentNode()\n\n\n  Overlay.prototype.getInstance = function getInstance() {\n    return this;\n  };\n\n  Overlay.prototype.render = function render() {\n    var _props = this.props,\n        prefix = _props.prefix,\n        className = _props.className,\n        style = _props.style,\n        propChildren = _props.children,\n        target = _props.target,\n        align = _props.align,\n        offset = _props.offset,\n        container = _props.container,\n        hasMask = _props.hasMask,\n        needAdjust = _props.needAdjust,\n        autoFit = _props.autoFit,\n        beforePosition = _props.beforePosition,\n        onPosition = _props.onPosition,\n        wrapperStyle = _props.wrapperStyle,\n        rtl = _props.rtl,\n        propShouldUpdatePosition = _props.shouldUpdatePosition,\n        cache = _props.cache,\n        wrapperClassName = _props.wrapperClassName,\n        onMaskMouseEnter = _props.onMaskMouseEnter,\n        onMaskMouseLeave = _props.onMaskMouseLeave,\n        maskClass = _props.maskClass,\n        isChildrenInMask = _props.isChildrenInMask,\n        pinFollowBaseElementWhenFixed = _props.pinFollowBaseElementWhenFixed;\n    var _state = this.state,\n        stateVisible = _state.visible,\n        status = _state.status,\n        animation = _state.animation;\n    var children = stateVisible || cache && this._isMounted ? propChildren : null;\n\n    if (children) {\n      var _classnames, _classnames2;\n\n      var child = Children.only(children); // if chlild is a functional component wrap in a component to allow a ref to be set\n\n      if (typeof child.type === 'function' && !(child.type.prototype instanceof Component)) {\n        child = React.createElement('div', {\n          role: 'none'\n        }, child);\n      }\n\n      var childClazz = classnames((_classnames = {}, _classnames[prefix + 'overlay-inner'] = true, _classnames[animation.in] = status === 'entering' || status === 'mounting', _classnames[animation.out] = status === 'leaving', _classnames[child.props.className] = !!child.props.className, _classnames[className] = !!className, _classnames));\n\n      if (typeof child.ref === 'string') {\n        throw new Error('Can not set ref by string in Overlay, use function instead.');\n      }\n\n      children = React.cloneElement(child, {\n        className: childClazz,\n        style: _extends({}, child.props.style, style),\n        ref: makeChain(this.saveContentRef, child.ref),\n        'aria-hidden': !stateVisible && cache && this._isMounted,\n        onClick: makeChain(this.props.onClick, child.props.onClick)\n      });\n\n      if (align) {\n        var shouldUpdatePosition = status === 'leaving' ? false : propShouldUpdatePosition;\n        children = React.createElement(Position, {\n          children: children,\n          target: target,\n          align: align,\n          offset: offset,\n          autoFit: autoFit,\n          container: container,\n          needAdjust: needAdjust,\n          pinFollowBaseElementWhenFixed: pinFollowBaseElementWhenFixed,\n          beforePosition: beforePosition,\n          onPosition: makeChain(this.handlePosition, onPosition),\n          shouldUpdatePosition: shouldUpdatePosition,\n          rtl: rtl\n        });\n      }\n\n      var wrapperClazz = classnames([prefix + 'overlay-wrapper', wrapperClassName]);\n\n      var newWrapperStyle = _extends({}, {\n        display: stateVisible ? '' : 'none'\n      }, wrapperStyle);\n\n      var maskClazz = classnames((_classnames2 = {}, _classnames2[prefix + 'overlay-backdrop'] = true, _classnames2[maskClass] = !!maskClass, _classnames2));\n      children = React.createElement('div', {\n        className: wrapperClazz,\n        style: newWrapperStyle,\n        dir: rtl ? 'rtl' : undefined\n      }, hasMask ? React.createElement('div', {\n        className: maskClazz,\n        onClick: this.handleMaskClick,\n        onMouseEnter: onMaskMouseEnter,\n        onMouseLeave: onMaskMouseLeave,\n        dir: rtl ? 'rtl' : undefined\n      }, isChildrenInMask && children) : null, !isChildrenInMask && children);\n    }\n\n    return React.createElement(Gateway, _extends({\n      container: container,\n      target: target,\n      children: children\n    }, {\n      ref: this.saveGatewayRef\n    }));\n  };\n\n  return Overlay;\n}(Component), _class.propTypes = {\n  prefix: PropTypes.string,\n  pure: PropTypes.bool,\n  rtl: PropTypes.bool,\n  className: PropTypes.string,\n  style: PropTypes.object,\n\n  /**\n   * 弹层内容\n   */\n  children: PropTypes.any,\n\n  /**\n   * 是否显示弹层\n   */\n  visible: PropTypes.bool,\n\n  /**\n   * 弹层请求关闭时触发事件的回调函数\n   * @param {String} type 弹层关闭的来源\n   * @param {Object} e DOM 事件\n   */\n  onRequestClose: PropTypes.func,\n\n  /**\n   * 弹层定位的参照元素\n   */\n  target: PropTypes.any,\n\n  /**\n   * 弹层相对于参照元素的定位, 详见开发指南的[定位部分](#定位)\n   */\n  align: PropTypes.oneOfType([PropTypes.string, PropTypes.bool]),\n\n  /**\n   * 弹层相对于trigger的定位的微调, 接收数组[hoz, ver], 表示弹层在 left / top 上的增量\n   * e.g. [100, 100] 表示往右(RTL 模式下是往左) 、下分布偏移100px\n   */\n  offset: PropTypes.array,\n\n  /**\n   * 渲染组件的容器，如果是函数需要返回 ref，如果是字符串则是该 DOM 的 id，也可以直接传入 DOM 节点\n   */\n  container: PropTypes.any,\n\n  /**\n   * 是否显示遮罩\n   */\n  hasMask: PropTypes.bool,\n\n  /**\n   * 是否支持 esc 按键关闭弹层\n   */\n  canCloseByEsc: PropTypes.bool,\n\n  /**\n   * 点击弹层外的区域是否关闭弹层，不显示遮罩时生效\n   */\n  canCloseByOutSideClick: PropTypes.bool,\n\n  /**\n   * 点击遮罩区域是否关闭弹层，显示遮罩时生效\n   */\n  canCloseByMask: PropTypes.bool,\n\n  /**\n   * 弹层打开前触发事件的回调函数\n   */\n  beforeOpen: PropTypes.func,\n\n  /**\n   * 弹层打开时触发事件的回调函数\n   */\n  onOpen: PropTypes.func,\n\n  /**\n   * 弹层打开后触发事件的回调函数, 如果有动画，则在动画结束后触发\n   */\n  afterOpen: PropTypes.func,\n\n  /**\n   * 弹层关闭前触发事件的回调函数\n   */\n  beforeClose: PropTypes.func,\n\n  /**\n   * 弹层关闭时触发事件的回调函数\n   */\n  onClose: PropTypes.func,\n\n  /**\n   * 弹层关闭后触发事件的回调函数, 如果有动画，则在动画结束后触发\n   */\n  afterClose: PropTypes.func,\n\n  /**\n   * 弹层定位完成前触发的事件\n   */\n  beforePosition: PropTypes.func,\n\n  /**\n   * 弹层定位完成时触发的事件\n   * @param {Object} config 定位的参数\n   * @param {Array} config.align 对齐方式，如 ['cc', 'cc']（如果开启 needAdjust，可能和预先设置的 align 不同）\n   * @param {Number} config.top 距离视口顶部距离\n   * @param {Number} config.left 距离视口左侧距离\n   * @param {Object} node 定位参照的容器节点\n   */\n  onPosition: PropTypes.func,\n\n  /**\n   * 是否在每次弹层重新渲染后强制更新定位信息，一般用于弹层内容区域大小发生变化时，仍需保持原来的定位方式\n   */\n  shouldUpdatePosition: PropTypes.bool,\n\n  /**\n   * 弹层打开时是否让其中的元素自动获取焦点\n   */\n  autoFocus: PropTypes.bool,\n\n  /**\n   * 当弹层由于页面滚动等情况不在可视区域时，是否自动调整定位以出现在可视区域\n   */\n  needAdjust: PropTypes.bool,\n\n  /**\n   * 是否禁用页面滚动\n   */\n  disableScroll: PropTypes.bool,\n\n  /**\n   * 隐藏时是否保留子节点\n   */\n  cache: PropTypes.bool,\n\n  /**\n   * 安全节点，当点击 document 的时候，如果包含该节点则不会关闭弹层，如果是函数需要返回 ref，如果是字符串则是该 DOM 的 id，也可以直接传入 DOM 节点，或者以上值组成的数组\n   */\n  safeNode: PropTypes.any,\n\n  /**\n   * 弹层的根节点的样式类\n   */\n  wrapperClassName: PropTypes.string,\n\n  /**\n   * 弹层的根节点的内联样式\n   */\n  wrapperStyle: PropTypes.object,\n\n  /**\n   * 配置动画的播放方式，支持 { in: 'enter-class', out: 'leave-class' } 的对象参数，如果设置为 false，则不播放动画。 请参考 Animate 组件的文档获取可用的动画名\n   * @default { in: 'expandInDown', out: 'expandOutUp' }\n   */\n  animation: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n  onMaskMouseEnter: PropTypes.func,\n  onMaskMouseLeave: PropTypes.func,\n  onClick: PropTypes.func,\n  maskClass: PropTypes.string,\n  isChildrenInMask: PropTypes.bool,\n  // 当 pin 元素（一般是弹层）是 fixed 布局的时候，pin 元素是否要跟随 base 元素（一般是trigger）\n  // 举例来说，dialog/drawer 这类组件弹层是不跟随trigger的，而 fixed 布局下的subNav是跟随trigger的\n  pinFollowBaseElementWhenFixed: PropTypes.bool\n}, _class.defaultProps = {\n  prefix: 'next-',\n  pure: false,\n  visible: false,\n  onRequestClose: noop,\n  target: Position.VIEWPORT,\n  align: 'tl bl',\n  offset: [0, 0],\n  hasMask: false,\n  canCloseByEsc: true,\n  canCloseByOutSideClick: true,\n  canCloseByMask: true,\n  beforeOpen: noop,\n  onOpen: noop,\n  afterOpen: noop,\n  beforeClose: noop,\n  onClose: noop,\n  afterClose: noop,\n  beforePosition: noop,\n  onPosition: noop,\n  onMaskMouseEnter: noop,\n  onMaskMouseLeave: noop,\n  shouldUpdatePosition: false,\n  autoFocus: false,\n  needAdjust: true,\n  disableScroll: false,\n  cache: false,\n  isChildrenInMask: false,\n  onClick: noop,\n  maskClass: ''\n}, _temp);\nOverlay.displayName = 'Overlay';\nexport default polyfill(Overlay);","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/node_modules/@alifd/next/es/overlay/overlay.js"],"names":["_extends","_classCallCheck","_possibleConstructorReturn","_inherits","_class","_temp","React","Children","Component","findDOMNode","PropTypes","classnames","polyfill","dom","events","focus","func","guid","KEYCODE","support","overlayManager","Gateway","Position","findNode","saveLastFocusNode","getFocusNodeList","backLastFocusNode","makeChain","noop","bindCtx","isScrollDisplay","element","scrollbarStyle","window","getComputedStyle","getPropertyValue","e","hasScroll","containerNode","parentNode","scrollHeight","clientHeight","scrollbar","width","getContainerNode","props","targetNode","target","container","prefixes","getStyleProperty","node","name","style","ret","i","length","containerNodeList","Overlay","_Component","_this","call","saveContentRef","ref","contentRef","saveGatewayRef","gatewayRef","lastAlign","align","state","visible","status","animation","getAnimation","willOpen","willClose","timeoutMap","getDerivedStateFromProps","nextProps","prevState","nextState","beforeOpen","beforeClose","prototype","componentDidMount","doAnimation","_isMounted","addDocumentEvents","addOverlay","componentDidUpdate","prevProps","componentWillUnmount","_isDestroyed","removeOverlay","removeDocumentEvents","focusTimeout","clearTimeout","_animation","off","open","close","_this2","onEntering","onLeaving","addAnimationEvents","setTimeout","onOpen","addClass","getWrapperNode","afterOpen","onClose","removeClass","afterClose","setFocusNode","getAnimationByAlign","in","out","_this3","getContentNode","id","on","end","handleAnimateEnd","bind","animationDelay","parseFloat","animationDuration","time","handlePosition","config","join","needAdjust","setState","onLeaved","onEntered","_this4","wrapperNode","disableScroll","document","body","_containerNode$style","overflow","paddingRight","cnInfo","find","m","count","getStyle","setStyle","push","_containerNode","_this5","idx","findIndex","cn","undefined","splice","_this6","autoFocus","_hasFocused","focusNodeList","getContent","err","getChildNode","canCloseByEsc","_keydownEvents","handleDocumentKeyDown","canCloseByOutSideClick","_clickEvents","handleDocumentClick","_touchEvents","_this7","forEach","event","keyCode","ESC","isCurrentOverlay","onRequestClose","isInShadowDOM","getRootNode","nodeType","getEventPath","path","composedPath","el","tagName","parentElement","matchInShadowDOM","eventPath","contains","_this8","safeNode","safeNodes","Array","isArray","concat","unshift","documentElement","handleMaskClick","currentTarget","canCloseByMask","getInstance","render","_props","prefix","className","propChildren","children","offset","hasMask","autoFit","beforePosition","onPosition","wrapperStyle","rtl","propShouldUpdatePosition","shouldUpdatePosition","cache","wrapperClassName","onMaskMouseEnter","onMaskMouseLeave","maskClass","isChildrenInMask","pinFollowBaseElementWhenFixed","_state","stateVisible","_classnames","_classnames2","child","only","type","createElement","role","childClazz","Error","cloneElement","onClick","wrapperClazz","newWrapperStyle","display","maskClazz","dir","onMouseEnter","onMouseLeave","propTypes","string","pure","bool","object","any","oneOfType","array","defaultProps","VIEWPORT","displayName"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp;\n\nimport React, { Children, Component } from 'react';\nimport { findDOMNode } from 'react-dom';\nimport PropTypes from 'prop-types';\nimport classnames from 'classnames';\nimport { polyfill } from 'react-lifecycles-compat';\nimport { dom, events, focus, func, guid, KEYCODE, support } from '../util';\nimport overlayManager from './manager';\nimport Gateway from './gateway';\nimport Position from './position';\nimport findNode from './utils/find-node';\n\nvar saveLastFocusNode = focus.saveLastFocusNode,\n    getFocusNodeList = focus.getFocusNodeList,\n    backLastFocusNode = focus.backLastFocusNode;\nvar makeChain = func.makeChain,\n    noop = func.noop,\n    bindCtx = func.bindCtx;\n\n\nvar isScrollDisplay = function isScrollDisplay(element) {\n    try {\n        var scrollbarStyle = window.getComputedStyle(element, '::-webkit-scrollbar');\n        return !scrollbarStyle || scrollbarStyle.getPropertyValue('display') !== 'none';\n    } catch (e) {\n        // ignore error for firefox\n    }\n\n    return true;\n};\nvar hasScroll = function hasScroll(containerNode) {\n    var parentNode = containerNode.parentNode;\n\n    return parentNode && parentNode.scrollHeight > parentNode.clientHeight && dom.scrollbar().width > 0 && isScrollDisplay(parentNode) && isScrollDisplay(containerNode);\n};\n\nvar getContainerNode = function getContainerNode(props) {\n    var targetNode = findNode(props.target);\n    return findNode(props.container, targetNode);\n};\n\nvar prefixes = ['-webkit-', '-moz-', '-o-', 'ms-', ''];\nvar getStyleProperty = function getStyleProperty(node, name) {\n    var style = window.getComputedStyle(node);\n    var ret = '';\n    for (var i = 0; i < prefixes.length; i++) {\n        ret = style.getPropertyValue(prefixes[i] + name);\n        if (ret) {\n            break;\n        }\n    }\n    return ret;\n};\n\n// 存 containerNode 信息\nvar containerNodeList = [];\n\n/**\n * Overlay\n */\nvar Overlay = (_temp = _class = function (_Component) {\n    _inherits(Overlay, _Component);\n\n    function Overlay(props) {\n        _classCallCheck(this, Overlay);\n\n        var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n        _this.saveContentRef = function (ref) {\n            _this.contentRef = ref;\n        };\n\n        _this.saveGatewayRef = function (ref) {\n            _this.gatewayRef = ref;\n        };\n\n        _this.lastAlign = props.align;\n\n        bindCtx(_this, ['handlePosition', 'handleAnimateEnd', 'handleDocumentKeyDown', 'handleDocumentClick', 'handleMaskClick', 'beforeOpen', 'beforeClose']);\n\n        _this.state = {\n            visible: false,\n            status: 'none',\n            animation: _this.getAnimation(props),\n            willOpen: false,\n            willClose: false\n        };\n\n        _this.timeoutMap = {};\n        return _this;\n    }\n\n    Overlay.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n        var willOpen = !prevState.visible && nextProps.visible;\n        var willClose = prevState.visible && !nextProps.visible;\n\n        var nextState = {\n            willOpen: willOpen,\n            willClose: willClose\n        };\n\n        if (willOpen) {\n            nextProps.beforeOpen && nextProps.beforeOpen();\n        } else if (willClose) {\n            nextProps.beforeClose && nextProps.beforeClose();\n        }\n\n        if (nextProps.animation || nextProps.animation === false) {\n            nextState.animation = nextProps.animation;\n        }\n\n        if (nextProps.animation !== false && support.animation) {\n            if (willOpen) {\n                nextState.visible = true;\n                nextState.status = 'mounting';\n            } else if (willClose) {\n                // can not set visible=false directly, otherwise animation not work without dom\n                // nextState.visible = false;\n                nextState.status = 'leaving';\n            }\n        } else if ('visible' in nextProps && nextProps.visible !== prevState.visible) {\n            nextState.visible = nextProps.visible;\n        }\n\n        return nextState;\n    };\n\n    Overlay.prototype.componentDidMount = function componentDidMount() {\n        if (this.state.willOpen) {\n            this.beforeOpen();\n        } else if (this.state.willClose) {\n            this.beforeClose();\n        }\n\n        if (this.state.visible) {\n            this.doAnimation(true, false);\n            this._isMounted = true;\n        }\n\n        this.addDocumentEvents();\n\n        overlayManager.addOverlay(this);\n    };\n\n    Overlay.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n        if (this.state.willOpen) {\n            this.beforeOpen();\n        } else if (this.state.willClose) {\n            this.beforeClose();\n        }\n\n        if (!this._isMounted && this.props.visible) {\n            this._isMounted = true;\n        }\n\n        if (this.props.align !== prevProps.align) {\n            this.lastAlign = prevProps.align;\n        }\n\n        var willOpen = !prevProps.visible && this.props.visible;\n        var willClose = prevProps.visible && !this.props.visible;\n\n        (willOpen || willClose) && this.doAnimation(willOpen, willClose);\n    };\n\n    Overlay.prototype.componentWillUnmount = function componentWillUnmount() {\n        this._isDestroyed = true;\n        this._isMounted = false;\n        overlayManager.removeOverlay(this);\n        this.removeDocumentEvents();\n        if (this.focusTimeout) {\n            clearTimeout(this.focusTimeout);\n        }\n        if (this._animation) {\n            this._animation.off();\n            this._animation = null;\n        }\n        this.beforeClose();\n    };\n\n    Overlay.prototype.doAnimation = function doAnimation(open, close) {\n        var _this2 = this;\n\n        if (this.state.animation && support.animation) {\n            if (open) {\n                this.onEntering();\n            } else if (close) {\n                this.onLeaving();\n            }\n            this.addAnimationEvents();\n        } else {\n            if (open) {\n                // fix https://github.com/alibaba-fusion/next/issues/1901\n                setTimeout(function () {\n                    _this2.props.onOpen();\n                    dom.addClass(_this2.getWrapperNode(), 'opened');\n                    overlayManager.addOverlay(_this2);\n                    _this2.props.afterOpen();\n                });\n            } else if (close) {\n                this.props.onClose();\n                dom.removeClass(this.getWrapperNode(), 'opened');\n                overlayManager.removeOverlay(this);\n                this.props.afterClose();\n            }\n            this.setFocusNode();\n        }\n    };\n\n    Overlay.prototype.getAnimation = function getAnimation(props) {\n        if (props.animation === false) {\n            return false;\n        }\n\n        if (props.animation) {\n            return props.animation;\n        }\n\n        return this.getAnimationByAlign(props.align);\n    };\n\n    Overlay.prototype.getAnimationByAlign = function getAnimationByAlign(align) {\n        switch (align[0]) {\n            case 't':\n                return {\n                    // 为了防止有的用户 js升级了而css没升级，所以把两个动画都保留了。\n                    // 动画不会叠加，会替代，顺序根据 src/animate/main.scss 中的样式先后顺序遵循css覆盖原则\n                    // fadeInDownSmall fadeOutUpSmall 优先级更高\n                    in: 'expandInDown fadeInDownSmall',\n                    out: 'expandOutUp fadeOutUpSmall'\n                };\n            case 'b':\n                return {\n                    in: 'fadeInUp',\n                    out: 'fadeOutDown'\n                };\n            default:\n                return {\n                    in: 'expandInDown fadeInDownSmall',\n                    out: 'expandOutUp fadeOutUpSmall'\n                };\n        }\n    };\n\n    Overlay.prototype.addAnimationEvents = function addAnimationEvents() {\n        var _this3 = this;\n\n        setTimeout(function () {\n            var node = _this3.getContentNode();\n            if (node) {\n                var id = guid();\n\n                _this3._animation = events.on(node, support.animation.end, _this3.handleAnimateEnd.bind(_this3, id));\n\n                var animationDelay = parseFloat(getStyleProperty(node, 'animation-delay')) || 0;\n                var animationDuration = parseFloat(getStyleProperty(node, 'animation-duration')) || 0;\n                var time = animationDelay + animationDuration;\n                if (time) {\n                    _this3.timeoutMap[id] = setTimeout(function () {\n                        _this3.handleAnimateEnd(id);\n                    }, time * 1000 + 200);\n                }\n            }\n        });\n    };\n\n    Overlay.prototype.handlePosition = function handlePosition(config) {\n        var align = config.align.join(' ');\n\n        if (!('animation' in this.props) && this.props.needAdjust && this.lastAlign !== align) {\n            this.setState({\n                animation: this.getAnimationByAlign(align)\n            });\n        }\n\n        var status = this.state.status;\n\n        if (status === 'mounting') {\n            this.setState({\n                status: 'entering'\n            });\n        }\n\n        this.lastAlign = align;\n    };\n\n    Overlay.prototype.handleAnimateEnd = function handleAnimateEnd(id) {\n        if (this.timeoutMap[id]) {\n            clearTimeout(this.timeoutMap[id]);\n        }\n        delete this.timeoutMap[id];\n\n        if (this._animation) {\n            this._animation.off();\n            this._animation = null;\n        }\n\n        if (!this._isMounted) {\n            return;\n        }\n\n        if (this.state.status === 'leaving') {\n            this.setState({\n                visible: false,\n                status: 'none'\n            });\n\n            this.onLeaved();\n            // dom结构首次出现 触发的是entering\n            // dom结构已经存在（例如设置了cache），触发的是mounting\n        } else if (this.state.status === 'entering' || this.state.status === 'mounting') {\n            this.setState({\n                status: 'none'\n            });\n\n            this.onEntered();\n        }\n    };\n\n    Overlay.prototype.onEntering = function onEntering() {\n        var _this4 = this;\n\n        if (this._isDestroyed) {\n            return;\n        }\n\n        // make sure overlay.ref has been called (eg: menu/popup-item called overlay.getInstance().getContentNode().)\n        setTimeout(function () {\n            var wrapperNode = _this4.getWrapperNode();\n            dom.addClass(wrapperNode, 'opened');\n            _this4.props.onOpen();\n        });\n    };\n\n    Overlay.prototype.onLeaving = function onLeaving() {\n        var wrapperNode = this.getWrapperNode();\n        dom.removeClass(wrapperNode, 'opened');\n        this.props.onClose();\n    };\n\n    Overlay.prototype.onEntered = function onEntered() {\n        overlayManager.addOverlay(this);\n        this.setFocusNode();\n        this.props.afterOpen();\n    };\n\n    Overlay.prototype.onLeaved = function onLeaved() {\n        overlayManager.removeOverlay(this);\n        this.setFocusNode();\n        this.props.afterClose();\n    };\n\n    Overlay.prototype.beforeOpen = function beforeOpen() {\n        if (this.props.disableScroll) {\n            var containerNode = getContainerNode(this.props) || document.body;\n            var _containerNode$style = containerNode.style,\n                overflow = _containerNode$style.overflow,\n                paddingRight = _containerNode$style.paddingRight;\n\n\n            var cnInfo = containerNodeList.find(function (m) {\n                return m.containerNode === containerNode;\n            }) || {\n                containerNode: containerNode,\n                count: 0\n            };\n\n            /**\n             * container 节点初始状态已经是 overflow=hidden 则忽略\n             * See {@link https://codesandbox.io/s/next-overlay-overflow-2-fulpq?file=/src/App.js}\n             */\n            if (cnInfo.count === 0 && overflow !== 'hidden') {\n                var style = {\n                    overflow: 'hidden'\n                };\n\n                cnInfo.overflow = overflow;\n\n                if (hasScroll(containerNode)) {\n                    cnInfo.paddingRight = paddingRight;\n                    style.paddingRight = dom.getStyle(containerNode, 'paddingRight') + dom.scrollbar().width + 'px';\n                }\n\n                dom.setStyle(containerNode, style);\n                containerNodeList.push(cnInfo);\n                cnInfo.count++;\n            } else if (cnInfo.count) {\n                cnInfo.count++;\n            }\n\n            this._containerNode = containerNode;\n        }\n    };\n\n    Overlay.prototype.beforeClose = function beforeClose() {\n        var _this5 = this;\n\n        if (this.props.disableScroll) {\n            var idx = containerNodeList.findIndex(function (cn) {\n                return cn.containerNode === _this5._containerNode;\n            });\n\n            if (idx !== -1) {\n                var cnInfo = containerNodeList[idx];\n                var overflow = cnInfo.overflow,\n                    paddingRight = cnInfo.paddingRight;\n\n                // 最后一个 overlay 的时候再将样式重置回去\n                // 此时 overflow 应该值在 beforeOpen 中设置的 hidden\n\n                if (cnInfo.count === 1 && this._containerNode && this._containerNode.style.overflow === 'hidden') {\n                    var style = {\n                        overflow: overflow\n                    };\n\n                    if (paddingRight !== undefined) {\n                        style.paddingRight = paddingRight;\n                    }\n\n                    dom.setStyle(this._containerNode, style);\n                }\n\n                cnInfo.count--;\n\n                if (cnInfo.count === 0) {\n                    containerNodeList.splice(idx, 1);\n                }\n            }\n            this._containerNode = undefined;\n        }\n    };\n\n    Overlay.prototype.setFocusNode = function setFocusNode() {\n        var _this6 = this;\n\n        if (!this.props.autoFocus) {\n            return;\n        }\n\n        if (this.state.visible && !this._hasFocused) {\n            saveLastFocusNode();\n            // 这个时候很可能上一个弹层的关闭事件还未触发，导致焦点已经回到触发的元素\n            // 这里延时处理一下，延时的时间为 document.click 捕获触发的延时时间\n            this.focusTimeout = setTimeout(function () {\n                var node = _this6.getContentNode();\n                if (node) {\n                    var focusNodeList = getFocusNodeList(node);\n                    if (focusNodeList.length) {\n                        focusNodeList[0].focus();\n                    }\n                    _this6._hasFocused = true;\n                }\n            }, 100);\n        } else if (!this.state.visible && this._hasFocused) {\n            backLastFocusNode();\n            this._hasFocused = false;\n        }\n    };\n\n    Overlay.prototype.getContent = function getContent() {\n        return this.contentRef;\n    };\n\n    Overlay.prototype.getContentNode = function getContentNode() {\n        try {\n            return findDOMNode(this.contentRef);\n        } catch (err) {\n            return null;\n        }\n    };\n\n    Overlay.prototype.getWrapperNode = function getWrapperNode() {\n        return this.gatewayRef ? this.gatewayRef.getChildNode() : null;\n    };\n\n    /**\n     * document global event\n     */\n\n\n    Overlay.prototype.addDocumentEvents = function addDocumentEvents() {\n        if (this.props.canCloseByEsc) {\n            this._keydownEvents = events.on(document, 'keydown', this.handleDocumentKeyDown);\n        }\n\n        if (this.props.canCloseByOutSideClick) {\n            this._clickEvents = events.on(document, 'click', this.handleDocumentClick);\n            this._touchEvents = events.on(document, 'touchend', this.handleDocumentClick);\n        }\n    };\n\n    Overlay.prototype.removeDocumentEvents = function removeDocumentEvents() {\n        var _this7 = this;\n\n        ['_keydownEvents', '_clickEvents', '_touchEvents'].forEach(function (event) {\n            if (_this7[event]) {\n                _this7[event].off();\n                _this7[event] = null;\n            }\n        });\n    };\n\n    Overlay.prototype.handleDocumentKeyDown = function handleDocumentKeyDown(e) {\n        if (this.state.visible && e.keyCode === KEYCODE.ESC && overlayManager.isCurrentOverlay(this)) {\n            this.props.onRequestClose('keyboard', e);\n        }\n    };\n\n    Overlay.prototype.isInShadowDOM = function isInShadowDOM(node) {\n        return node.getRootNode ? node.getRootNode().nodeType === 11 : false;\n    };\n\n    Overlay.prototype.getEventPath = function getEventPath(event) {\n        // 参考 https://github.com/spring-media/react-shadow-dom-retarget-events/blob/master/index.js#L29\n        return event.path || event.composedPath && event.composedPath() || this.composedPath(event.target);\n    };\n\n    Overlay.prototype.composedPath = function composedPath(el) {\n        var path = [];\n        while (el) {\n            path.push(el);\n            if (el.tagName === 'HTML') {\n                path.push(document);\n                path.push(window);\n                return path;\n            }\n            el = el.parentElement;\n        }\n    };\n\n    Overlay.prototype.matchInShadowDOM = function matchInShadowDOM(node, e) {\n        if (this.isInShadowDOM(node)) {\n            // Shadow DOM 环境中，触发点击事件，监听 document click 事件获得的事件源\n            // 并非实际触发的 dom 节点，而是 Shadow DOM 的 host 节点\n            // 进而会导致如 Select 组件的下拉弹层打开后立即关闭等问题\n            // 因此额外增加 node 和 eventPath 的判断\n            var eventPath = this.getEventPath(e);\n            return node === eventPath[0] || node.contains(eventPath[0]);\n        }\n\n        return false;\n    };\n\n    Overlay.prototype.handleDocumentClick = function handleDocumentClick(e) {\n        var _this8 = this;\n\n        if (this.state.visible) {\n            var safeNode = this.props.safeNode;\n\n            var safeNodes = Array.isArray(safeNode) ? [].concat(safeNode) : [safeNode];\n            safeNodes.unshift(function () {\n                return _this8.getWrapperNode();\n            });\n\n            for (var i = 0; i < safeNodes.length; i++) {\n                var node = findNode(safeNodes[i], this.props);\n                // HACK: 如果触发点击的节点是弹层内部的节点，并且在被点击后立即销毁，那么此时无法使用 node.contains(e.target)\n                // 来判断此时点击的节点是否是弹层内部的节点，额外判断\n                if (node && (node === e.target || node.contains(e.target) || this.matchInShadowDOM(node, e) || e.target !== document && !document.documentElement.contains(e.target))) {\n                    return;\n                }\n            }\n\n            this.props.onRequestClose('docClick', e);\n        }\n    };\n\n    Overlay.prototype.handleMaskClick = function handleMaskClick(e) {\n        if (e.currentTarget === e.target && this.props.canCloseByMask) {\n            this.props.onRequestClose('maskClick', e);\n        }\n    };\n\n    // 兼容过去的用法: this.popupRef.getInstance().overlay.getInstance().getContentNode()\n    Overlay.prototype.getInstance = function getInstance() {\n        return this;\n    };\n\n    Overlay.prototype.render = function render() {\n        var _props = this.props,\n            prefix = _props.prefix,\n            className = _props.className,\n            style = _props.style,\n            propChildren = _props.children,\n            target = _props.target,\n            align = _props.align,\n            offset = _props.offset,\n            container = _props.container,\n            hasMask = _props.hasMask,\n            needAdjust = _props.needAdjust,\n            autoFit = _props.autoFit,\n            beforePosition = _props.beforePosition,\n            onPosition = _props.onPosition,\n            wrapperStyle = _props.wrapperStyle,\n            rtl = _props.rtl,\n            propShouldUpdatePosition = _props.shouldUpdatePosition,\n            cache = _props.cache,\n            wrapperClassName = _props.wrapperClassName,\n            onMaskMouseEnter = _props.onMaskMouseEnter,\n            onMaskMouseLeave = _props.onMaskMouseLeave,\n            maskClass = _props.maskClass,\n            isChildrenInMask = _props.isChildrenInMask,\n            pinFollowBaseElementWhenFixed = _props.pinFollowBaseElementWhenFixed;\n        var _state = this.state,\n            stateVisible = _state.visible,\n            status = _state.status,\n            animation = _state.animation;\n\n\n        var children = stateVisible || cache && this._isMounted ? propChildren : null;\n        if (children) {\n            var _classnames, _classnames2;\n\n            var child = Children.only(children);\n            // if chlild is a functional component wrap in a component to allow a ref to be set\n            if (typeof child.type === 'function' && !(child.type.prototype instanceof Component)) {\n                child = React.createElement(\n                    'div',\n                    { role: 'none' },\n                    child\n                );\n            }\n            var childClazz = classnames((_classnames = {}, _classnames[prefix + 'overlay-inner'] = true, _classnames[animation.in] = status === 'entering' || status === 'mounting', _classnames[animation.out] = status === 'leaving', _classnames[child.props.className] = !!child.props.className, _classnames[className] = !!className, _classnames));\n            if (typeof child.ref === 'string') {\n                throw new Error('Can not set ref by string in Overlay, use function instead.');\n            }\n\n            children = React.cloneElement(child, {\n                className: childClazz,\n                style: _extends({}, child.props.style, style),\n                ref: makeChain(this.saveContentRef, child.ref),\n                'aria-hidden': !stateVisible && cache && this._isMounted,\n                onClick: makeChain(this.props.onClick, child.props.onClick)\n            });\n\n            if (align) {\n                var shouldUpdatePosition = status === 'leaving' ? false : propShouldUpdatePosition;\n                children = React.createElement(Position, {\n                    children: children,\n                    target: target,\n                    align: align,\n                    offset: offset,\n                    autoFit: autoFit,\n                    container: container,\n                    needAdjust: needAdjust,\n                    pinFollowBaseElementWhenFixed: pinFollowBaseElementWhenFixed,\n                    beforePosition: beforePosition,\n                    onPosition: makeChain(this.handlePosition, onPosition),\n                    shouldUpdatePosition: shouldUpdatePosition,\n                    rtl: rtl\n                });\n            }\n\n            var wrapperClazz = classnames([prefix + 'overlay-wrapper', wrapperClassName]);\n            var newWrapperStyle = _extends({}, {\n                display: stateVisible ? '' : 'none'\n            }, wrapperStyle);\n\n            var maskClazz = classnames((_classnames2 = {}, _classnames2[prefix + 'overlay-backdrop'] = true, _classnames2[maskClass] = !!maskClass, _classnames2));\n\n            children = React.createElement(\n                'div',\n                { className: wrapperClazz, style: newWrapperStyle, dir: rtl ? 'rtl' : undefined },\n                hasMask ? React.createElement(\n                    'div',\n                    {\n                        className: maskClazz,\n                        onClick: this.handleMaskClick,\n                        onMouseEnter: onMaskMouseEnter,\n                        onMouseLeave: onMaskMouseLeave,\n                        dir: rtl ? 'rtl' : undefined\n                    },\n                    isChildrenInMask && children\n                ) : null,\n                !isChildrenInMask && children\n            );\n        }\n\n        return React.createElement(Gateway, _extends({ container: container, target: target, children: children }, { ref: this.saveGatewayRef }));\n    };\n\n    return Overlay;\n}(Component), _class.propTypes = {\n    prefix: PropTypes.string,\n    pure: PropTypes.bool,\n    rtl: PropTypes.bool,\n    className: PropTypes.string,\n    style: PropTypes.object,\n    /**\n     * 弹层内容\n     */\n    children: PropTypes.any,\n    /**\n     * 是否显示弹层\n     */\n    visible: PropTypes.bool,\n    /**\n     * 弹层请求关闭时触发事件的回调函数\n     * @param {String} type 弹层关闭的来源\n     * @param {Object} e DOM 事件\n     */\n    onRequestClose: PropTypes.func,\n    /**\n     * 弹层定位的参照元素\n     */\n    target: PropTypes.any,\n    /**\n     * 弹层相对于参照元素的定位, 详见开发指南的[定位部分](#定位)\n     */\n    align: PropTypes.oneOfType([PropTypes.string, PropTypes.bool]),\n    /**\n     * 弹层相对于trigger的定位的微调, 接收数组[hoz, ver], 表示弹层在 left / top 上的增量\n     * e.g. [100, 100] 表示往右(RTL 模式下是往左) 、下分布偏移100px\n     */\n    offset: PropTypes.array,\n    /**\n     * 渲染组件的容器，如果是函数需要返回 ref，如果是字符串则是该 DOM 的 id，也可以直接传入 DOM 节点\n     */\n    container: PropTypes.any,\n    /**\n     * 是否显示遮罩\n     */\n    hasMask: PropTypes.bool,\n    /**\n     * 是否支持 esc 按键关闭弹层\n     */\n    canCloseByEsc: PropTypes.bool,\n    /**\n     * 点击弹层外的区域是否关闭弹层，不显示遮罩时生效\n     */\n    canCloseByOutSideClick: PropTypes.bool,\n    /**\n     * 点击遮罩区域是否关闭弹层，显示遮罩时生效\n     */\n    canCloseByMask: PropTypes.bool,\n    /**\n     * 弹层打开前触发事件的回调函数\n     */\n    beforeOpen: PropTypes.func,\n    /**\n     * 弹层打开时触发事件的回调函数\n     */\n    onOpen: PropTypes.func,\n    /**\n     * 弹层打开后触发事件的回调函数, 如果有动画，则在动画结束后触发\n     */\n    afterOpen: PropTypes.func,\n    /**\n     * 弹层关闭前触发事件的回调函数\n     */\n    beforeClose: PropTypes.func,\n    /**\n     * 弹层关闭时触发事件的回调函数\n     */\n    onClose: PropTypes.func,\n    /**\n     * 弹层关闭后触发事件的回调函数, 如果有动画，则在动画结束后触发\n     */\n    afterClose: PropTypes.func,\n    /**\n     * 弹层定位完成前触发的事件\n     */\n    beforePosition: PropTypes.func,\n    /**\n     * 弹层定位完成时触发的事件\n     * @param {Object} config 定位的参数\n     * @param {Array} config.align 对齐方式，如 ['cc', 'cc']（如果开启 needAdjust，可能和预先设置的 align 不同）\n     * @param {Number} config.top 距离视口顶部距离\n     * @param {Number} config.left 距离视口左侧距离\n     * @param {Object} node 定位参照的容器节点\n     */\n    onPosition: PropTypes.func,\n    /**\n     * 是否在每次弹层重新渲染后强制更新定位信息，一般用于弹层内容区域大小发生变化时，仍需保持原来的定位方式\n     */\n    shouldUpdatePosition: PropTypes.bool,\n    /**\n     * 弹层打开时是否让其中的元素自动获取焦点\n     */\n    autoFocus: PropTypes.bool,\n    /**\n     * 当弹层由于页面滚动等情况不在可视区域时，是否自动调整定位以出现在可视区域\n     */\n    needAdjust: PropTypes.bool,\n    /**\n     * 是否禁用页面滚动\n     */\n    disableScroll: PropTypes.bool,\n    /**\n     * 隐藏时是否保留子节点\n     */\n    cache: PropTypes.bool,\n    /**\n     * 安全节点，当点击 document 的时候，如果包含该节点则不会关闭弹层，如果是函数需要返回 ref，如果是字符串则是该 DOM 的 id，也可以直接传入 DOM 节点，或者以上值组成的数组\n     */\n    safeNode: PropTypes.any,\n    /**\n     * 弹层的根节点的样式类\n     */\n    wrapperClassName: PropTypes.string,\n    /**\n     * 弹层的根节点的内联样式\n     */\n    wrapperStyle: PropTypes.object,\n    /**\n     * 配置动画的播放方式，支持 { in: 'enter-class', out: 'leave-class' } 的对象参数，如果设置为 false，则不播放动画。 请参考 Animate 组件的文档获取可用的动画名\n     * @default { in: 'expandInDown', out: 'expandOutUp' }\n     */\n    animation: PropTypes.oneOfType([PropTypes.object, PropTypes.bool]),\n    onMaskMouseEnter: PropTypes.func,\n    onMaskMouseLeave: PropTypes.func,\n    onClick: PropTypes.func,\n    maskClass: PropTypes.string,\n    isChildrenInMask: PropTypes.bool,\n    // 当 pin 元素（一般是弹层）是 fixed 布局的时候，pin 元素是否要跟随 base 元素（一般是trigger）\n    // 举例来说，dialog/drawer 这类组件弹层是不跟随trigger的，而 fixed 布局下的subNav是跟随trigger的\n    pinFollowBaseElementWhenFixed: PropTypes.bool\n}, _class.defaultProps = {\n    prefix: 'next-',\n    pure: false,\n    visible: false,\n    onRequestClose: noop,\n    target: Position.VIEWPORT,\n    align: 'tl bl',\n    offset: [0, 0],\n    hasMask: false,\n    canCloseByEsc: true,\n    canCloseByOutSideClick: true,\n    canCloseByMask: true,\n    beforeOpen: noop,\n    onOpen: noop,\n    afterOpen: noop,\n    beforeClose: noop,\n    onClose: noop,\n    afterClose: noop,\n    beforePosition: noop,\n    onPosition: noop,\n    onMaskMouseEnter: noop,\n    onMaskMouseLeave: noop,\n    shouldUpdatePosition: false,\n    autoFocus: false,\n    needAdjust: true,\n    disableScroll: false,\n    cache: false,\n    isChildrenInMask: false,\n    onClick: noop,\n    maskClass: ''\n}, _temp);\nOverlay.displayName = 'Overlay';\n\n\nexport default polyfill(Overlay);"]},"metadata":{},"sourceType":"module"}