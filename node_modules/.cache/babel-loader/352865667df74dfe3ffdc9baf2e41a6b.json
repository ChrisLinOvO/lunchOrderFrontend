{"ast":null,"code":"\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.format = format;\nexports.asyncMap = asyncMap;\nexports.asyncMapPromise = asyncMapPromise;\nexports.complementError = complementError;\nexports.processErrorResults = processErrorResults;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar formatRegExp = /%[sdj%]/g;\n\nfunction format() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  var i = 1;\n  var f = args[0];\n  var len = args.length;\n\n  if (typeof f === 'function') {\n    return f(args.slice(1));\n  }\n\n  if (typeof f === 'string') {\n    var str = String(f).replace(formatRegExp, function (x) {\n      if (x === '%%') {\n        return '%';\n      }\n\n      if (i >= len) {\n        return x;\n      }\n\n      switch (x) {\n        case '%s':\n          return String(args[i++]);\n\n        case '%d':\n          return Number(args[i++]);\n\n        case '%j':\n          try {\n            return JSON.stringify(args[i++]);\n          } catch (_) {\n            return '[Circular]';\n          }\n\n        default:\n          return x;\n      }\n    });\n    return str;\n  }\n\n  return f;\n}\n\nfunction asyncSerialArray(arr, func, callback) {\n  var index = 0;\n  var arrLength = arr.length;\n\n  function next(errors) {\n    if (errors && errors.length) {\n      callback(errors);\n      return;\n    }\n\n    var original = index;\n    index = index + 1;\n\n    if (original < arrLength) {\n      func(arr[original], next);\n    } else {\n      return callback([]);\n    }\n  }\n\n  next([]);\n}\n/**\n * 平铺规则\n * @param  {object} objArr [description]\n * @return {Array}        [description]\n */\n\n\nfunction flattenObjArr(objArr) {\n  var ret = [];\n  Object.keys(objArr).forEach(function (k) {\n    Object.keys(objArr[k]).forEach(function (r) {\n      ret.push(objArr[k][r]);\n    });\n  });\n  return ret;\n}\n/**\n * 异步调用\n * @param  {map}   objArr   校验规则对象列表\n * @param  {object}   option   配置项\n * @param  {Function} func     每个校验规则\n * @param  {Function} callback 全部完成后的执行\n */\n\n\nfunction asyncMap(objArr, option, func, callback) {\n  // 发现第一个错误即返回\n  if (option.first) {\n    var flattenArr = flattenObjArr(objArr);\n    return asyncSerialArray(flattenArr, func, callback);\n  }\n\n  var objArrKeys = Object.keys(objArr);\n  var objArrLength = objArrKeys.length;\n  var total = 0;\n  var results = [];\n\n  var next = function next(errors) {\n    results.push(errors);\n    total++;\n\n    if (total === objArrLength) {\n      return callback(results);\n    }\n  };\n\n  objArrKeys.forEach(function (key) {\n    var arr = objArr[key];\n    asyncSerialArray(arr, func, next);\n  });\n}\n\nfunction resolveErrorPromiseInSeries(_x, _x2) {\n  return _resolveErrorPromiseInSeries.apply(this, arguments);\n}\n\nfunction _resolveErrorPromiseInSeries() {\n  _resolveErrorPromiseInSeries = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(arr, func) {\n    return _regenerator.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", arr.reduce( /*#__PURE__*/function () {\n              var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(prevPromise, next) {\n                var errors;\n                return _regenerator.default.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.prev = 0;\n                        _context.next = 3;\n                        return prevPromise;\n\n                      case 3:\n                        errors = _context.sent;\n                        _context.next = 9;\n                        break;\n\n                      case 6:\n                        _context.prev = 6;\n                        _context.t0 = _context[\"catch\"](0);\n                        errors = _context.t0;\n\n                      case 9:\n                        if (!(errors && errors.length)) {\n                          _context.next = 11;\n                          break;\n                        }\n\n                        return _context.abrupt(\"return\", errors);\n\n                      case 11:\n                        return _context.abrupt(\"return\", func(next));\n\n                      case 12:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee, null, [[0, 6]]);\n              }));\n\n              return function (_x6, _x7) {\n                return _ref.apply(this, arguments);\n              };\n            }(), Promise.resolve()));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _resolveErrorPromiseInSeries.apply(this, arguments);\n}\n\nfunction asyncMapPromise(_x3, _x4, _x5) {\n  return _asyncMapPromise.apply(this, arguments);\n}\n\nfunction _asyncMapPromise() {\n  _asyncMapPromise = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(objArr, option, func) {\n    var flatObjArr, objArrValues;\n    return _regenerator.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (!option.first) {\n              _context3.next = 3;\n              break;\n            }\n\n            flatObjArr = flattenObjArr(objArr);\n            return _context3.abrupt(\"return\", resolveErrorPromiseInSeries(flatObjArr, func));\n\n          case 3:\n            objArrValues = Object.values(objArr);\n            return _context3.abrupt(\"return\", Promise.all(objArrValues.map(function (val) {\n              return resolveErrorPromiseInSeries(val, func);\n            })));\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _asyncMapPromise.apply(this, arguments);\n}\n\nfunction complementError(rule) {\n  return function (oe) {\n    if (oe && oe.message) {\n      oe.field = rule.field;\n      return oe;\n    }\n\n    return {\n      message: oe,\n      field: rule.field\n    };\n  };\n}\n/**\n *\n * @param {Array} results errors from running validation\n * @returns {Object} { errors: Array, fields: Object }\n */\n\n\nfunction processErrorResults() {\n  var results = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var errors = [];\n  var fields = {};\n\n  function add(e) {\n    if (Array.isArray(e)) {\n      errors = errors.concat(e);\n    } else {\n      errors.push(e);\n    }\n  }\n\n  for (var i = 0; i < results.length; i++) {\n    add(results[i]);\n  }\n\n  if (!errors.length) {\n    errors = null;\n    fields = null;\n  } else {\n    for (var _i = 0; _i < errors.length; _i++) {\n      var field = errors[_i].field;\n\n      if (field) {\n        fields[field] = fields[field] || [];\n        fields[field].push(errors[_i]);\n      }\n    }\n  }\n\n  return {\n    errors: errors,\n    fields: fields\n  };\n}","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/node_modules/@alifd/validate/lib/util.js"],"names":["_interopRequireDefault","require","Object","defineProperty","exports","value","format","asyncMap","asyncMapPromise","complementError","processErrorResults","_regenerator","_asyncToGenerator2","formatRegExp","_len","arguments","length","args","Array","_key","i","f","len","slice","str","String","replace","x","Number","JSON","stringify","_","asyncSerialArray","arr","func","callback","index","arrLength","next","errors","original","flattenObjArr","objArr","ret","keys","forEach","k","r","push","option","first","flattenArr","objArrKeys","objArrLength","total","results","key","resolveErrorPromiseInSeries","_x","_x2","_resolveErrorPromiseInSeries","apply","default","mark","_callee2","wrap","_callee2$","_context2","prev","abrupt","reduce","_ref","_callee","prevPromise","_callee$","_context","sent","t0","stop","_x6","_x7","Promise","resolve","_x3","_x4","_x5","_asyncMapPromise","_callee3","flatObjArr","objArrValues","_callee3$","_context3","values","all","map","val","rule","oe","message","field","undefined","fields","add","e","isArray","concat","_i"],"mappings":"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","sourcesContent":["\"use strict\";\n\nvar _interopRequireDefault = require(\"@babel/runtime/helpers/interopRequireDefault\");\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.format = format;\nexports.asyncMap = asyncMap;\nexports.asyncMapPromise = asyncMapPromise;\nexports.complementError = complementError;\nexports.processErrorResults = processErrorResults;\n\nvar _regenerator = _interopRequireDefault(require(\"@babel/runtime/regenerator\"));\n\nvar _asyncToGenerator2 = _interopRequireDefault(require(\"@babel/runtime/helpers/asyncToGenerator\"));\n\nvar formatRegExp = /%[sdj%]/g;\n\nfunction format() {\n  for (var _len = arguments.length, args = new Array(_len), _key = 0; _key < _len; _key++) {\n    args[_key] = arguments[_key];\n  }\n\n  var i = 1;\n  var f = args[0];\n  var len = args.length;\n\n  if (typeof f === 'function') {\n    return f(args.slice(1));\n  }\n\n  if (typeof f === 'string') {\n    var str = String(f).replace(formatRegExp, function (x) {\n      if (x === '%%') {\n        return '%';\n      }\n\n      if (i >= len) {\n        return x;\n      }\n\n      switch (x) {\n        case '%s':\n          return String(args[i++]);\n\n        case '%d':\n          return Number(args[i++]);\n\n        case '%j':\n          try {\n            return JSON.stringify(args[i++]);\n          } catch (_) {\n            return '[Circular]';\n          }\n\n        default:\n          return x;\n      }\n    });\n    return str;\n  }\n\n  return f;\n}\n\nfunction asyncSerialArray(arr, func, callback) {\n  var index = 0;\n  var arrLength = arr.length;\n\n  function next(errors) {\n    if (errors && errors.length) {\n      callback(errors);\n      return;\n    }\n\n    var original = index;\n    index = index + 1;\n\n    if (original < arrLength) {\n      func(arr[original], next);\n    } else {\n      return callback([]);\n    }\n  }\n\n  next([]);\n}\n/**\n * 平铺规则\n * @param  {object} objArr [description]\n * @return {Array}        [description]\n */\n\n\nfunction flattenObjArr(objArr) {\n  var ret = [];\n  Object.keys(objArr).forEach(function (k) {\n    Object.keys(objArr[k]).forEach(function (r) {\n      ret.push(objArr[k][r]);\n    });\n  });\n  return ret;\n}\n/**\n * 异步调用\n * @param  {map}   objArr   校验规则对象列表\n * @param  {object}   option   配置项\n * @param  {Function} func     每个校验规则\n * @param  {Function} callback 全部完成后的执行\n */\n\n\nfunction asyncMap(objArr, option, func, callback) {\n  // 发现第一个错误即返回\n  if (option.first) {\n    var flattenArr = flattenObjArr(objArr);\n    return asyncSerialArray(flattenArr, func, callback);\n  }\n\n  var objArrKeys = Object.keys(objArr);\n  var objArrLength = objArrKeys.length;\n  var total = 0;\n  var results = [];\n\n  var next = function next(errors) {\n    results.push(errors);\n    total++;\n\n    if (total === objArrLength) {\n      return callback(results);\n    }\n  };\n\n  objArrKeys.forEach(function (key) {\n    var arr = objArr[key];\n    asyncSerialArray(arr, func, next);\n  });\n}\n\nfunction resolveErrorPromiseInSeries(_x, _x2) {\n  return _resolveErrorPromiseInSeries.apply(this, arguments);\n}\n\nfunction _resolveErrorPromiseInSeries() {\n  _resolveErrorPromiseInSeries = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee2(arr, func) {\n    return _regenerator.default.wrap(function _callee2$(_context2) {\n      while (1) {\n        switch (_context2.prev = _context2.next) {\n          case 0:\n            return _context2.abrupt(\"return\", arr.reduce( /*#__PURE__*/function () {\n              var _ref = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee(prevPromise, next) {\n                var errors;\n                return _regenerator.default.wrap(function _callee$(_context) {\n                  while (1) {\n                    switch (_context.prev = _context.next) {\n                      case 0:\n                        _context.prev = 0;\n                        _context.next = 3;\n                        return prevPromise;\n\n                      case 3:\n                        errors = _context.sent;\n                        _context.next = 9;\n                        break;\n\n                      case 6:\n                        _context.prev = 6;\n                        _context.t0 = _context[\"catch\"](0);\n                        errors = _context.t0;\n\n                      case 9:\n                        if (!(errors && errors.length)) {\n                          _context.next = 11;\n                          break;\n                        }\n\n                        return _context.abrupt(\"return\", errors);\n\n                      case 11:\n                        return _context.abrupt(\"return\", func(next));\n\n                      case 12:\n                      case \"end\":\n                        return _context.stop();\n                    }\n                  }\n                }, _callee, null, [[0, 6]]);\n              }));\n\n              return function (_x6, _x7) {\n                return _ref.apply(this, arguments);\n              };\n            }(), Promise.resolve()));\n\n          case 1:\n          case \"end\":\n            return _context2.stop();\n        }\n      }\n    }, _callee2);\n  }));\n  return _resolveErrorPromiseInSeries.apply(this, arguments);\n}\n\nfunction asyncMapPromise(_x3, _x4, _x5) {\n  return _asyncMapPromise.apply(this, arguments);\n}\n\nfunction _asyncMapPromise() {\n  _asyncMapPromise = (0, _asyncToGenerator2.default)( /*#__PURE__*/_regenerator.default.mark(function _callee3(objArr, option, func) {\n    var flatObjArr, objArrValues;\n    return _regenerator.default.wrap(function _callee3$(_context3) {\n      while (1) {\n        switch (_context3.prev = _context3.next) {\n          case 0:\n            if (!option.first) {\n              _context3.next = 3;\n              break;\n            }\n\n            flatObjArr = flattenObjArr(objArr);\n            return _context3.abrupt(\"return\", resolveErrorPromiseInSeries(flatObjArr, func));\n\n          case 3:\n            objArrValues = Object.values(objArr);\n            return _context3.abrupt(\"return\", Promise.all(objArrValues.map(function (val) {\n              return resolveErrorPromiseInSeries(val, func);\n            })));\n\n          case 5:\n          case \"end\":\n            return _context3.stop();\n        }\n      }\n    }, _callee3);\n  }));\n  return _asyncMapPromise.apply(this, arguments);\n}\n\nfunction complementError(rule) {\n  return function (oe) {\n    if (oe && oe.message) {\n      oe.field = rule.field;\n      return oe;\n    }\n\n    return {\n      message: oe,\n      field: rule.field\n    };\n  };\n}\n/**\n *\n * @param {Array} results errors from running validation\n * @returns {Object} { errors: Array, fields: Object }\n */\n\n\nfunction processErrorResults() {\n  var results = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n  var errors = [];\n  var fields = {};\n\n  function add(e) {\n    if (Array.isArray(e)) {\n      errors = errors.concat(e);\n    } else {\n      errors.push(e);\n    }\n  }\n\n  for (var i = 0; i < results.length; i++) {\n    add(results[i]);\n  }\n\n  if (!errors.length) {\n    errors = null;\n    fields = null;\n  } else {\n    for (var _i = 0; _i < errors.length; _i++) {\n      var field = errors[_i].field;\n\n      if (field) {\n        fields[field] = fields[field] || [];\n        fields[field].push(errors[_i]);\n      }\n    }\n  }\n\n  return {\n    errors: errors,\n    fields: fields\n  };\n}"]},"metadata":{},"sourceType":"script"}