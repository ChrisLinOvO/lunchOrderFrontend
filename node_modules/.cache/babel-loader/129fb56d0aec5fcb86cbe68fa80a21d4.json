{"ast":null,"code":"import _Button from \"@alifd/next/es/button\";\nimport _Dialog from \"@alifd/next/es/dialog\";\nimport _DatePicker from \"@alifd/next/es/date-picker\";\nimport _Input from \"@alifd/next/es/input\";\nimport _Message from \"@alifd/next/es/message\";\nimport _Form from \"@alifd/next/es/form\";\nimport _Select from \"@alifd/next/es/select\";\n\nvar _jsxFileName = \"/Users/Chris/Project/lunch-order-backstage/src/components/Menu/Menu.jsx\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect, useRef, Fragment } from 'react';\nimport Swal from 'sweetalert2';\nimport client from '../../lib/feathers';\nimport axios from 'axios';\nimport moment from 'moment';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst Option = _Select.Option;\nconst {\n  Item\n} = _Form;\n\nconst Menu = props => {\n  _s();\n\n  const {\n    dbName,\n    keys,\n    text\n  } = props.menuProps;\n  const dbService = client.service(`${dbName}`); // const [listData, setListData] = useState([]);\n  // const [listDataAll, setListDataAll] = useState([]);\n\n  const [writeData, setWriteData] = useState({});\n  const [popupState, setPopupState] = useState(false);\n  const [editKey, setEditKey] = useState(false);\n  const [editIndex, setEditIndex] = useState(\"\"); //uploads files\n\n  const [parsed, setParsed] = useState([]);\n  const [parsed64, setParsed64] = useState([]); //Base64\n\n  const [file, setFile] = useState(\"\");\n  const uploadFile = useRef(null);\n  const uploadExcelFile = useRef(null); // sort\n\n  const [curdataIndex, setcurDataIndex] = useState('money');\n  const [curorder, setcurOrder] = useState('asc'); // change page\n\n  const [currentPage, setCurrentPage] = useState(1);\n  const [postsPerPage] = useState(10);\n  const indexOfLastPost = currentPage * postsPerPage;\n  const indexOfFirstPost = indexOfLastPost - postsPerPage;\n  const currentPosts = props.listData.slice(indexOfFirstPost, indexOfLastPost); // dbService\n\n  async function funFind(para) {\n    const result = await dbService.find({\n      query: para\n    }); // console.log(result);\n\n    return result && result.data ? result.data : [];\n  }\n\n  async function funCreate(obj) {\n    return await dbService.create(obj);\n  }\n\n  async function funUpdate(id, obj) {\n    return await dbService.patch(id, obj);\n  }\n\n  async function funRemove(id) {\n    return await dbService.remove(id);\n  }\n\n  const serverDataUpdate = (dataIndex, order) => {\n    const rdataIndex = dataIndex || curdataIndex;\n    const rorder = order || curorder;\n    funFind({}).then(result => {\n      const sortedArr = result.sort((a, b) => {\n        const result = (typeof a[rdataIndex] === 'number' ? a[rdataIndex].toString() : a[rdataIndex]).localeCompare(typeof b[rdataIndex] === 'number' ? b[rdataIndex].toString() : b[rdataIndex]);\n        return rorder === 'asc' ? result > 0 ? 1 : -1 : result > 0 ? -1 : 1;\n      });\n      props.listDataProps(sortedArr);\n      props.listDataAllProps(sortedArr);\n    });\n  };\n\n  const onTableSort = (dataIndex, order) => {\n    console.log('==dataIndex:', dataIndex, 'order:', order);\n    setcurDataIndex(dataIndex);\n    setcurOrder(order);\n    serverDataUpdate(dataIndex, order);\n  };\n\n  useEffect(() => {\n    serverDataUpdate();\n  }, []);\n\n  function beforeUpload() {\n    return new Promise(async (resolve, reject) => {\n      if (uploadFile.current.files.length > 0) {\n        const isLt20M = (await uploadFile.current.files[0].size) / 1024 / 1024 < 20;\n\n        if (!isLt20M) {\n          _Message.error('Image must smaller than 20MB!');\n\n          return reject();\n        }\n\n        resolve(isLt20M);\n      } else {\n        setParsed64('');\n      }\n    });\n  }\n\n  const handleFiles = async () => {\n    try {\n      await beforeUpload();\n      const files = [...parsed];\n      const data = await uploadFile.current.files[0]; // console.log(data)\n\n      files.push(data);\n      setParsed(files); //轉Base64 上傳檔案後呈現沒有寫到DB\n\n      const reader = new FileReader();\n\n      reader.onload = function () {\n        let dataURL = reader.result;\n        setParsed64(dataURL);\n      };\n\n      reader.readAsDataURL(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const addCreateData = (key, value) => {\n    //-------Input OnChange Event\n    let obj = {};\n    obj[key] = value;\n    setWriteData({ ...writeData,\n      ...obj\n    });\n  };\n\n  const createSend = () => {\n    //-------Create Data 送出\n    if (editKey == true) {\n      //Check is edit state\n      Swal.fire({\n        title: `確定修改此資料?`,\n        text: '請確認修改資料!!',\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#BEBEBE',\n        confirmButtonText: '確定',\n        cancelButtonText: '取消'\n      }).then(result => {\n        if (result.isConfirmed) {\n          const data = currentPosts[editIndex];\n          let newObj = { ...data,\n            ...writeData\n          };\n          patchUploads(newObj).then(res => {\n            console.log('==update success:', res);\n            Swal.fire({\n              position: 'center',\n              icon: 'success',\n              title: '編輯成功',\n              showConfirmButton: false,\n              timer: 1500\n            });\n            serverDataUpdate();\n            setWriteData({});\n            setParsed64('');\n            setEditKey(false);\n            setPopupState(false);\n          }).catch(error => {\n            console.log('==update fail:', error);\n\n            _Message.success('更新失敗');\n          });\n        }\n      });\n    } else {\n      Swal.fire({\n        title: `確定新增此資料?`,\n        text: '請確認資料填寫完整!!',\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#BEBEBE',\n        confirmButtonText: '確定',\n        cancelButtonText: '取消'\n      }).then(result => {\n        if (result.isConfirmed) {\n          createUploads().then(res => {\n            Swal.fire('成功!', `此資料已新增`, 'success');\n            console.log('==create success:', res);\n            serverDataUpdate();\n            setWriteData({});\n            setParsed64('');\n            setEditKey(false);\n            setPopupState(false);\n          }).catch(error => {\n            console.log('==create fail:', error); // Message.error(`${err}`);\n          });\n        }\n      });\n    }\n  };\n\n  const typeComponents = (e, type) => {\n    // Render Type Components\n    let element;\n\n    switch (type) {\n      case \"input\":\n        element = /*#__PURE__*/_jsxDEV(_Input, {\n          value: writeData[e],\n          onChange: value => {\n            addCreateData(e, value);\n          },\n          placeholder: e\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 224,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case \"datePicker\":\n        element = /*#__PURE__*/_jsxDEV(_DatePicker, {\n          value: writeData[e],\n          placeholder: e,\n          onChange: value => {\n            addCreateData(e, moment(value).format(\"YYYY-MM-DD\"));\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 235,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case \"textArea\":\n        element = /*#__PURE__*/_jsxDEV(_Input.TextArea, {\n          value: writeData[e],\n          placeholder: e,\n          maxLength: 500,\n          rows: 6,\n          hasLimitHint: true,\n          \"aria-label\": \"input max length 500\",\n          onChange: value => {\n            addCreateData(e, value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 246,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case \"select\":\n        element = /*#__PURE__*/_jsxDEV(_Select, {\n          value: writeData[e],\n          hasClear: true,\n          style: {\n            width: '100%'\n          },\n          placeholder: e,\n          dataSource: props.categoryProps,\n          onChange: value => {\n            addCreateData(e, value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 261,\n          columnNumber: 11\n        }, this);\n        break;\n\n      case \"uploads\":\n        element = /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            accept: \"image/png, image/jpeg image/jpg\",\n            ref: uploadFile,\n            onChange: handleFiles,\n            type: \"file\",\n            id: \"file\",\n            name: \"files\" // multiple\n\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 276,\n            columnNumber: 13\n          }, this), editKey == true ? /*#__PURE__*/_jsxDEV(\"img\", {\n            style: {\n              width: '50px',\n              height: '50px'\n            },\n            src: `${parsed64.length > 0 ? parsed64 : currentPosts[editIndex].files}`,\n            alt: \"\\u5716\\u7247\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 286,\n            columnNumber: 15\n          }, this) : null]\n        }, void 0, true);\n        break;\n\n      case \"multiSelect\":\n        element = /*#__PURE__*/_jsxDEV(_Fragment, {\n          children: /*#__PURE__*/_jsxDEV(_Select, {\n            mode: \"multiple\",\n            value: writeData[e],\n            showSearch: true,\n            onChange: value => {\n              addCreateData(e, value);\n            },\n            dataSource: props.venderNameProps,\n            style: {\n              width: '100%'\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 302,\n            columnNumber: 13\n          }, this)\n        }, void 0, false);\n        break;\n    }\n\n    return element;\n  };\n\n  function createUploads() {\n    //Use uploads create\n    return new Promise(async (resolve, reject) => {\n      try {\n        const formData = new FormData();\n        Object.keys(writeData).forEach(eKey => {\n          if (eKey == \"vendorName\") {\n            formData.append(\"vendorName\", JSON.stringify(writeData[eKey]));\n          } else {\n            formData.append(eKey, writeData[eKey]);\n          }\n        }); // formData.append('createdTime', new Date().toLocaleString());\n        // formData.append('updatedTime', new Date().toLocaleString());\n\n        if (uploadFile.current !== null && uploadFile.current.files && uploadFile.current.files.length > 0) {\n          formData.append('files', uploadFile.current.files[0]);\n        }\n\n        const Res = await axios(`http://localhost:3030/uploads`, {\n          method: 'POST',\n          headers: {\n            authorization: window.localStorage['feathers-jwt']\n          },\n          data: formData\n        });\n        resolve(Res);\n      } catch (error) {\n        reject(error);\n      }\n    });\n  }\n\n  function patchUploads(data) {\n    //Use uploads patch\n    return new Promise(async (resolve, reject) => {\n      try {\n        let patchUrl = `/uploads?type=${dbName}&id=${data._id}`;\n        const formData = new FormData();\n        const passKeys = ['files', '_id']; //禁止FormData Patch add Key\n\n        Object.keys(data).forEach(eKey => {\n          if (!passKeys.includes(eKey)) {\n            if (eKey == \"vendorName\") {\n              formData.append(\"vendorName\", JSON.stringify(writeData[eKey]));\n            } else {\n              formData.append(eKey, writeData[eKey]);\n            }\n          }\n        });\n\n        if (uploadFile.current.files.length > 0) {\n          formData.append('files', uploadFile.current.files[0]);\n        }\n\n        if (!uploadFile.current.files.length) {\n          patchUrl = `/uploads?type=${dbName}&id=${data._id}&img=keep`;\n        }\n\n        console.log('rdy to PP:', formData);\n        const Res = await axios(patchUrl, {\n          method: 'PATCH',\n          headers: {\n            authorization: window.localStorage['feathers-jwt']\n          },\n          data: formData\n        });\n        resolve(Res);\n      } catch (error) {\n        console.log('PP err:', error);\n        reject();\n      }\n    });\n  }\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [/*#__PURE__*/_jsxDEV(_Dialog, {\n      hasMask: false,\n      visible: popupState,\n      onOk: () => {\n        createSend();\n      },\n      onCancel: () => {\n        setPopupState(false);\n        setEditKey(false);\n        setWriteData({});\n      },\n      onClose: () => {\n        setPopupState(false);\n        setEditKey(false);\n        setWriteData({});\n      },\n      children: [...Object.keys(keys)].map((e, nb) => {\n        //-------Render Create Element\n        const type = keys[e].type;\n        if (keys[e].text == \"建立時間\" || keys[e].text == \"修改時間\" || keys[e].text == \"證照\") return \"\";\n        return /*#__PURE__*/_jsxDEV(Fragment, {\n          children: /*#__PURE__*/_jsxDEV(_Form, {\n            children: /*#__PURE__*/_jsxDEV(Item, {\n              label: keys[e].text,\n              children: typeComponents(e, type)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 428,\n              columnNumber: 15\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 426,\n            columnNumber: 13\n          }, this)\n        }, keys[e].text, false, {\n          fileName: _jsxFileName,\n          lineNumber: 425,\n          columnNumber: 18\n        }, this);\n      })\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 403,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      children: /*#__PURE__*/_jsxDEV(_Button, {\n        type: \"primary\",\n        onClick: () => {\n          setPopupState(true);\n        },\n        children: \"\\u65B0\\u589E\\u83DC\\u55AE\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 438,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 437,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n};\n\n_s(Menu, \"0j6Ja0ePZ+npSHqrLd6ikTECqzY=\");\n\n_c = Menu;\nexport default Menu;\n\nvar _c;\n\n$RefreshReg$(_c, \"Menu\");","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/src/components/Menu/Menu.jsx"],"names":["React","useState","useEffect","useRef","Fragment","Swal","client","axios","moment","Option","Item","Menu","props","dbName","keys","text","menuProps","dbService","service","writeData","setWriteData","popupState","setPopupState","editKey","setEditKey","editIndex","setEditIndex","parsed","setParsed","parsed64","setParsed64","file","setFile","uploadFile","uploadExcelFile","curdataIndex","setcurDataIndex","curorder","setcurOrder","currentPage","setCurrentPage","postsPerPage","indexOfLastPost","indexOfFirstPost","currentPosts","listData","slice","funFind","para","result","find","query","data","funCreate","obj","create","funUpdate","id","patch","funRemove","remove","serverDataUpdate","dataIndex","order","rdataIndex","rorder","then","sortedArr","sort","a","b","toString","localeCompare","listDataProps","listDataAllProps","onTableSort","console","log","beforeUpload","Promise","resolve","reject","current","files","length","isLt20M","size","error","handleFiles","push","reader","FileReader","onload","dataURL","readAsDataURL","err","addCreateData","key","value","createSend","fire","title","icon","showCancelButton","confirmButtonColor","cancelButtonColor","confirmButtonText","cancelButtonText","isConfirmed","newObj","patchUploads","res","position","showConfirmButton","timer","catch","success","createUploads","typeComponents","e","type","element","format","width","categoryProps","height","venderNameProps","formData","FormData","Object","forEach","eKey","append","JSON","stringify","Res","method","headers","authorization","window","localStorage","patchUrl","_id","passKeys","includes","map","nb"],"mappings":"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","sourcesContent":["import React, { useState, useEffect, useRef, Fragment } from 'react';\nimport {\n  Button,\n  Dialog,\n  Input,\n  Form,\n  Select,\n  DatePicker,\n  Message,\n  Card,\n  Table,\n  Pagination\n} from \"@alifd/next\";\nimport Swal from 'sweetalert2';\nimport client from '../../lib/feathers';\nimport axios from 'axios';\nimport moment from 'moment';\nconst Option = Select.Option;\nconst { Item } = Form;\nconst Menu = (props) => {\n  const { dbName, keys, text } = props.menuProps;\n  const dbService = client.service(`${dbName}`);\n  // const [listData, setListData] = useState([]);\n  // const [listDataAll, setListDataAll] = useState([]);\n  const [writeData, setWriteData] = useState({});\n  const [popupState, setPopupState] = useState(false);\n  const [editKey, setEditKey] = useState(false);\n  const [editIndex, setEditIndex] = useState(\"\");\n  //uploads files\n  const [parsed, setParsed] = useState([]);\n  const [parsed64, setParsed64] = useState([]); //Base64\n  const [file, setFile] = useState(\"\");\n  const uploadFile = useRef(null);\n  const uploadExcelFile = useRef(null);\n  // sort\n  const [curdataIndex, setcurDataIndex] = useState('money');\n  const [curorder, setcurOrder] = useState('asc');\n  // change page\n  const [currentPage, setCurrentPage] = useState(1);\n  const [postsPerPage] = useState(10);\n  const indexOfLastPost = currentPage * postsPerPage;\n  const indexOfFirstPost = indexOfLastPost - postsPerPage;\n  const currentPosts = props.listData.slice(indexOfFirstPost, indexOfLastPost);\n  // dbService\n  async function funFind(para) {\n    const result = await dbService.find({ query: para });\n    // console.log(result);\n    return result && result.data ? result.data : [];\n  }\n\n  async function funCreate(obj) {\n    return (await dbService.create(obj))\n  }\n  async function funUpdate(id, obj) {\n    return (await dbService.patch(id, obj))\n  }\n  async function funRemove(id) {\n    return (await dbService.remove(id))\n  }\n  const serverDataUpdate = (dataIndex, order) => {\n    const rdataIndex = dataIndex || curdataIndex;\n    const rorder = order || curorder;\n\n    funFind({}).then((result) => {\n      const sortedArr = result.sort((a, b) => {\n        const result = (typeof a[rdataIndex] === 'number'\n          ? a[rdataIndex].toString()\n          : a[rdataIndex]\n        ).localeCompare(\n          typeof b[rdataIndex] === 'number'\n            ? b[rdataIndex].toString()\n            : b[rdataIndex]\n        );\n        return rorder === 'asc' ? (result > 0 ? 1 : -1) : result > 0 ? -1 : 1;\n      })\n      props.listDataProps(sortedArr);\n      props.listDataAllProps(sortedArr)\n    });\n\n\n  };\n  const onTableSort = (dataIndex, order) => {\n    console.log('==dataIndex:', dataIndex, 'order:', order);\n    setcurDataIndex(dataIndex);\n    setcurOrder(order);\n    serverDataUpdate(dataIndex, order);\n  };\n\n  useEffect(() => {\n    serverDataUpdate();\n  }, []);\n\n\n\n  function beforeUpload() {\n    return new Promise(async (resolve, reject) => {\n      if (uploadFile.current.files.length > 0) {\n        const isLt20M =\n          (await uploadFile.current.files[0].size) / 1024 / 1024 < 20;\n\n        if (!isLt20M) {\n          Message.error('Image must smaller than 20MB!');\n          return reject();\n        }\n        resolve(isLt20M);\n      } else {\n        setParsed64('')\n      }\n    });\n  }\n\n  const handleFiles = async () => {\n    try {\n      await beforeUpload();\n      const files = [...parsed];\n      const data = await uploadFile.current.files[0];\n      // console.log(data)\n      files.push(data);\n      setParsed(files);\n\n      //轉Base64 上傳檔案後呈現沒有寫到DB\n      const reader = new FileReader();\n      reader.onload = function () {\n        let dataURL = reader.result;\n        setParsed64(dataURL);\n      };\n      reader.readAsDataURL(data);\n    } catch (err) {\n      console.log(err);\n    }\n  };\n\n  const addCreateData = (key, value) => {\n    //-------Input OnChange Event\n    let obj = {};\n    obj[key] = value;\n\n    setWriteData({ ...writeData, ...obj });\n  };\n  const createSend = () => {\n    //-------Create Data 送出\n    if (editKey == true) { //Check is edit state\n\n\n      Swal.fire({\n        title: `確定修改此資料?`,\n        text: '請確認修改資料!!',\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#BEBEBE',\n        confirmButtonText: '確定',\n        cancelButtonText: '取消',\n      }).then((result) => {\n        if (result.isConfirmed) {\n\n          const data = currentPosts[editIndex];\n\n          let newObj = { ...data, ...writeData }\n\n          patchUploads(newObj).then((res) => {\n            console.log('==update success:', res);\n            Swal.fire({\n              position: 'center',\n              icon: 'success',\n              title: '編輯成功',\n              showConfirmButton: false,\n              timer: 1500,\n            });\n            serverDataUpdate();\n            setWriteData({});\n            setParsed64('');\n            setEditKey(false);\n            setPopupState(false);\n          })\n            .catch((error) => {\n              console.log('==update fail:', error);\n              Message.success('更新失敗');\n            });\n\n\n        }\n      });\n    } else {\n\n      Swal.fire({\n        title: `確定新增此資料?`,\n        text: '請確認資料填寫完整!!',\n        icon: 'warning',\n        showCancelButton: true,\n        confirmButtonColor: '#3085d6',\n        cancelButtonColor: '#BEBEBE',\n        confirmButtonText: '確定',\n        cancelButtonText: '取消',\n      }).then((result) => {\n        if (result.isConfirmed) {\n          createUploads().then((res) => {\n            Swal.fire('成功!', `此資料已新增`, 'success');\n            console.log('==create success:', res);\n            serverDataUpdate();\n            setWriteData({});\n            setParsed64('');\n            setEditKey(false);\n            setPopupState(false);\n          }).catch((error) => {\n            console.log('==create fail:', error);\n            // Message.error(`${err}`);\n          })\n\n        }\n      });\n\n    }\n  };\n\n\n\n  const typeComponents = (e, type) => {\n    // Render Type Components\n    let element;\n    switch (type) {\n      case \"input\":\n        element = (\n          <Input\n            value={writeData[e]}\n            onChange={(value) => {\n              addCreateData(e, value);\n            }}\n            placeholder={e}\n          />\n        );\n        break;\n      case \"datePicker\":\n        element = (\n          <DatePicker\n            value={writeData[e]}\n            placeholder={e}\n            onChange={(value) => {\n              addCreateData(e, moment(value).format(\"YYYY-MM-DD\"));\n            }}\n          />\n        );\n        break;\n      case \"textArea\":\n        element = (\n          <Input.TextArea\n            value={writeData[e]}\n            placeholder={e}\n            maxLength={500}\n            rows={6}\n            hasLimitHint\n            aria-label=\"input max length 500\"\n            onChange={(value) => {\n              addCreateData(e, value);\n            }}\n          />\n        );\n        break;\n      case \"select\":\n        element = (\n          <Select\n            value={writeData[e]}\n            hasClear\n            style={{ width: '100%' }}\n            placeholder={e}\n            dataSource={props.categoryProps}\n            onChange={(value) => {\n              addCreateData(e, value);\n            }}\n          />\n        );\n        break;\n      case \"uploads\":\n        element = (\n          <>\n            <input\n              accept=\"image/png, image/jpeg image/jpg\"\n              ref={uploadFile}\n              onChange={handleFiles}\n              type=\"file\"\n              id=\"file\"\n              name=\"files\"\n            // multiple\n            />\n            {editKey == true ?\n              <img\n                style={{ width: '50px', height: '50px' }}\n                src={`${parsed64.length > 0 ? parsed64 : currentPosts[editIndex].files}`}\n                alt=\"圖片\"\n              />\n\n              : null\n\n            }\n\n            {/* <img  src={`${parsed64.length > 0 ? parsed64 : ezconImg}`} alt=\"圖片\"></img> */}\n          </>);\n        break;\n      case \"multiSelect\":\n        element = (\n          <>\n            <Select\n              mode=\"multiple\"\n              value={writeData[e]}\n              showSearch\n              onChange={(value) => {\n                addCreateData(e, value);\n              }}\n              dataSource={props.venderNameProps}\n              style={{ width: '100%' }}\n            />\n\n          </>);\n        break;\n    }\n    return element;\n  };\n\n\n\n\n  function createUploads() {//Use uploads create\n    return new Promise(async (resolve, reject) => {\n      try {\n\n        const formData = new FormData();\n        Object.keys(writeData).forEach((eKey) => {\n\n          if (eKey == \"vendorName\") {\n            formData.append(\"vendorName\", JSON.stringify(writeData[eKey]));\n          } else {\n            formData.append(eKey, writeData[eKey]);\n          }\n        });\n        // formData.append('createdTime', new Date().toLocaleString());\n        // formData.append('updatedTime', new Date().toLocaleString());\n\n        if (uploadFile.current !== null && uploadFile.current.files && uploadFile.current.files.length > 0) {\n          formData.append('files', uploadFile.current.files[0]);\n        }\n\n        const Res = await axios(`http://localhost:3030/uploads`, {\n          method: 'POST',\n          headers: { authorization: window.localStorage['feathers-jwt'] },\n          data: formData\n        });\n\n        resolve(Res);\n      } catch (error) {\n        reject(error);\n      }\n    })\n\n  }\n\n  function patchUploads(data) {//Use uploads patch\n    return new Promise(async (resolve, reject) => {\n      try {\n        let patchUrl = `/uploads?type=${dbName}&id=${data._id}`\n        const formData = new FormData();\n\n        const passKeys = ['files', '_id'];//禁止FormData Patch add Key\n\n        Object.keys(data).forEach((eKey) => {\n\n          if (!passKeys.includes(eKey)) {\n            if (eKey == \"vendorName\") {\n              formData.append(\"vendorName\", JSON.stringify(writeData[eKey]));\n            } else {\n              formData.append(eKey, writeData[eKey]);\n            }\n          }\n        });\n\n        if (uploadFile.current.files.length > 0) {\n          formData.append('files', uploadFile.current.files[0]);\n        }\n        if (!uploadFile.current.files.length) {\n          patchUrl = `/uploads?type=${dbName}&id=${data._id}&img=keep`\n        }\n        console.log('rdy to PP:', formData);\n        const Res = await axios(patchUrl, {\n          method: 'PATCH',\n          headers: { authorization: window.localStorage['feathers-jwt'] },\n          data: formData\n        });\n\n        resolve(Res);\n      } catch (error) {\n        console.log('PP err:', error);\n        reject();\n      }\n    })\n  }\n\n\n\n\n\n\n  return (\n    <>\n      <Dialog\n\n        hasMask={false}\n        visible={popupState}\n        onOk={() => {\n          createSend();\n        }}\n        onCancel={() => {\n          setPopupState(false);\n          setEditKey(false);\n          setWriteData({});\n        }}\n        onClose={() => {\n          setPopupState(false);\n          setEditKey(false);\n          setWriteData({});\n        }}\n      >\n        {[...Object.keys(keys)].map((e, nb) => {\n          //-------Render Create Element\n          const type = keys[e].type;\n          if (keys[e].text == \"建立時間\" || keys[e].text == \"修改時間\" || keys[e].text == \"證照\") return \"\";\n          return <Fragment key={keys[e].text}>\n            <Form>\n\n              <Item label={keys[e].text} >\n                {typeComponents(e, type)}\n              </Item>\n\n            </Form>\n          </Fragment>;\n        })}\n      </Dialog>\n\n      <div >\n        <Button\n          type=\"primary\"\n          onClick={() => {\n            setPopupState(true);\n          }}\n        >\n          新增菜單\n                </Button>\n      \n\n      </div>\n\n     \n\n\n    </>\n  );\n}\n\nexport default Menu;\n"]},"metadata":{},"sourceType":"module"}