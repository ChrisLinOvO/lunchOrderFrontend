{"ast":null,"code":"import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp;\n\nimport PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport cx from 'classnames';\nimport { polyfill } from 'react-lifecycles-compat';\nimport { findDOMNode } from 'react-dom';\nimport { events } from '../util';\n\nvar NOOP = function NOOP() {};\n\nvar MAX_SYNC_UPDATES = 40;\n\nvar isEqualSubset = function isEqualSubset(a, b) {\n  for (var key in b) {\n    if (a[key] !== b[key]) {\n      return false;\n    }\n  }\n\n  return true;\n};\n\nvar getOffset = function getOffset(el) {\n  var offset = el.clientLeft || 0;\n\n  do {\n    offset += el.offsetTop || 0;\n    el = el.offsetParent;\n  } while (el);\n\n  return offset;\n};\n\nvar constrain = function constrain(from, size, _ref) {\n  var children = _ref.children,\n      minSize = _ref.minSize;\n  var length = children && children.length;\n  size = Math.max(size, minSize);\n\n  if (size > length) {\n    size = length;\n  }\n\n  from = from ? Math.max(Math.min(from, length - size), 0) : 0;\n  return {\n    from: from,\n    size: size\n  };\n};\n/** VirtualList */\n\n\nvar VirtualList = (_temp = _class = function (_Component) {\n  _inherits(VirtualList, _Component);\n\n  function VirtualList(props) {\n    _classCallCheck(this, VirtualList);\n\n    var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n    var jumpIndex = props.jumpIndex;\n\n    var _constrain = constrain(jumpIndex, 0, props),\n        from = _constrain.from,\n        size = _constrain.size;\n\n    _this.state = {\n      from: from,\n      size: size\n    };\n    _this.cache = {};\n    _this.cacheAdd = {};\n    _this.scrollTo = _this.scrollTo.bind(_this);\n    _this.cachedScroll = null;\n    _this.unstable = false;\n    _this.updateCounter = 0;\n    return _this;\n  }\n\n  VirtualList.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n    var from = prevState.from,\n        size = prevState.size;\n    return constrain(from, size, nextProps);\n  };\n\n  VirtualList.prototype.componentDidMount = function componentDidMount() {\n    var jumpIndex = this.props.jumpIndex;\n    this.updateFrameAndClearCache = this.updateFrameAndClearCache.bind(this);\n    events.on(window, 'resize', this.updateFrameAndClearCache);\n    this.updateFrame(this.scrollTo.bind(this, jumpIndex));\n  };\n\n  VirtualList.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n    var _this2 = this;\n\n    var oldIndex = prevProps.jumpIndex;\n    var newIndex = this.props.jumpIndex;\n\n    if (oldIndex !== newIndex) {\n      this.updateFrame(this.scrollTo.bind(this, newIndex));\n    } // If the list has reached an unstable state, prevent an infinite loop.\n\n\n    if (this.unstable) {\n      return;\n    }\n\n    if (++this.updateCounter > MAX_SYNC_UPDATES) {\n      this.unstable = true;\n    }\n\n    if (!this.updateCounterTimeoutId) {\n      this.updateCounterTimeoutId = setTimeout(function () {\n        _this2.updateCounter = 0;\n        delete _this2.updateCounterTimeoutId;\n      }, 0);\n    }\n\n    this.updateFrame();\n  };\n\n  VirtualList.prototype.componentWillUnmount = function componentWillUnmount() {\n    events.off(window, 'resize', this.updateFrameAndClearCache);\n    events.off(this.scrollParent, 'scroll', this.updateFrameAndClearCache);\n    events.off(this.scrollParent, 'mousewheel', NOOP);\n  };\n\n  VirtualList.prototype.maybeSetState = function maybeSetState(b, cb) {\n    if (isEqualSubset(this.state, b)) {\n      return cb();\n    }\n\n    this.setState(b, cb);\n  };\n\n  VirtualList.prototype.getEl = function getEl() {\n    return this.el || this.items || {};\n  };\n\n  VirtualList.prototype.getScrollParent = function getScrollParent() {\n    var el = this.getEl();\n    el = el.parentElement;\n\n    switch (window.getComputedStyle(el).overflowY) {\n      case 'auto':\n      case 'scroll':\n      case 'overlay':\n      case 'visible':\n        return el;\n    }\n\n    return window;\n  };\n\n  VirtualList.prototype.getScroll = function getScroll() {\n    // Cache scroll position as this causes a forced synchronous layout.\n    // if (typeof this.cachedScroll === 'number') {\n    //     return this.cachedScroll;\n    // }\n    var scrollParent = this.scrollParent;\n    var scrollKey = 'scrollTop';\n    var actual = scrollParent === window ? // Firefox always returns document.body[scrollKey] as 0 and Chrome/Safari\n    // always return document.documentElement[scrollKey] as 0, so take\n    // whichever has a value.\n    document.body[scrollKey] || document.documentElement[scrollKey] : scrollParent[scrollKey];\n    var max = this.getScrollSize() - this.getViewportSize();\n    var scroll = Math.max(0, Math.min(actual, max));\n    var el = this.getEl();\n    this.cachedScroll = getOffset(scrollParent) + scroll - getOffset(el);\n    return this.cachedScroll;\n  };\n\n  VirtualList.prototype.setScroll = function setScroll(offset) {\n    var scrollParent = this.scrollParent;\n    offset += getOffset(this.getEl());\n\n    if (scrollParent === window) {\n      return window.scrollTo(0, offset);\n    }\n\n    offset -= getOffset(this.scrollParent);\n    scrollParent.scrollTop = offset;\n  };\n\n  VirtualList.prototype.getViewportSize = function getViewportSize() {\n    var scrollParent = this.scrollParent;\n    return scrollParent === window ? window.innerHeight : scrollParent.clientHeight;\n  };\n\n  VirtualList.prototype.getScrollSize = function getScrollSize() {\n    var scrollParent = this.scrollParent;\n    var _document = document,\n        body = _document.body,\n        documentElement = _document.documentElement;\n    var key = 'scrollHeight';\n    return scrollParent === window ? Math.max(body[key], documentElement[key]) : scrollParent[key];\n  };\n\n  VirtualList.prototype.getStartAndEnd = function getStartAndEnd() {\n    var threshold = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props.threshold;\n    var scroll = this.getScroll();\n    var trueScroll = scroll;\n    var start = Math.max(0, trueScroll - threshold);\n    var end = trueScroll + this.getViewportSize() + threshold;\n    return {\n      start: start,\n      end: end\n    };\n  }; // Called by 'scroll' and 'resize' events, clears scroll position cache.\n\n\n  VirtualList.prototype.updateFrameAndClearCache = function updateFrameAndClearCache(cb) {\n    this.cachedScroll = null;\n    return this.updateFrame(cb);\n  };\n\n  VirtualList.prototype.updateFrame = function updateFrame(cb) {\n    this.updateScrollParent();\n\n    if (typeof cb !== 'function') {\n      cb = NOOP;\n    }\n\n    return this.updateVariableFrame(cb);\n  };\n\n  VirtualList.prototype.updateScrollParent = function updateScrollParent() {\n    var prev = this.scrollParent;\n    this.scrollParent = this.getScrollParent();\n\n    if (prev === this.scrollParent) {\n      return;\n    }\n\n    if (prev) {\n      events.off(prev, 'scroll', this.updateFrameAndClearCache);\n      events.off(prev, 'mousewheel', NOOP);\n    }\n\n    events.on(this.scrollParent, 'scroll', this.updateFrameAndClearCache);\n    events.on(this.scrollParent, 'mousewheel', NOOP); // You have to attach mousewheel listener to the scrollable element.\n    // Just an empty listener. After that onscroll events will be fired synchronously.\n  };\n\n  VirtualList.prototype.updateVariableFrame = function updateVariableFrame(cb) {\n    if (!this.props.itemSizeGetter) {\n      this.cacheSizes();\n    }\n\n    var _getStartAndEnd = this.getStartAndEnd(),\n        start = _getStartAndEnd.start,\n        end = _getStartAndEnd.end;\n\n    var _props = this.props,\n        pageSize = _props.pageSize,\n        children = _props.children;\n    var length = children.length;\n    var space = 0;\n    var from = 0;\n    var size = 0;\n    var maxFrom = length - 1;\n\n    while (from < maxFrom) {\n      var itemSize = this.getSizeOf(from);\n\n      if (itemSize === null || itemSize === undefined || space + itemSize > start) {\n        break;\n      }\n\n      space += itemSize;\n      ++from;\n    }\n\n    var maxSize = length - from;\n\n    while (size < maxSize && space < end) {\n      var _itemSize = this.getSizeOf(from + size);\n\n      if (_itemSize === null || _itemSize === undefined) {\n        size = Math.min(size + pageSize, maxSize);\n        break;\n      }\n\n      space += _itemSize;\n      ++size;\n    }\n\n    this.maybeSetState({\n      from: from,\n      size: size\n    }, cb);\n  };\n\n  VirtualList.prototype.getSpaceBefore = function getSpaceBefore(index) {\n    var cache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n    if (!index) {\n      return 0;\n    }\n\n    if (cache[index] !== null && cache[index] !== undefined) {\n      return cache[index] || 0;\n    } // Find the closest space to index there is a cached value for.\n\n\n    var from = index;\n\n    while (from > 0 && (cache[from] === null || cache[from] === undefined)) {\n      from--;\n    } // Finally, accumulate sizes of items from - index.\n\n\n    var space = cache[from] || 0;\n\n    for (var i = from; i < index; ++i) {\n      cache[i] = space;\n      var itemSize = this.getSizeOf(i);\n\n      if (itemSize === null || itemSize === undefined) {\n        break;\n      }\n\n      space += itemSize;\n    }\n\n    cache[index] = space;\n    return cache[index] || 0;\n  };\n\n  VirtualList.prototype.cacheSizes = function cacheSizes() {\n    var cache = this.cache;\n    var from = this.state.from;\n    var _items = this.items,\n        children = _items.children,\n        _items$props = _items.props,\n        props = _items$props === undefined ? {} : _items$props;\n    var itemEls = children || props.children || [];\n\n    try {\n      // <Select useVirtual /> 模式下，在快速点击切换Tab的情况下（Select实例快速出现、消失） 有时会出现this.items不存在，导致页面报错。怀疑是Select的异步timer渲染逻辑引起的\n      for (var i = 0, l = itemEls.length; i < l; ++i) {\n        var ulRef = findDOMNode(this.items);\n        var height = ulRef.children[i].offsetHeight;\n\n        if (height > 0) {\n          cache[from + i] = height;\n        }\n      }\n    } catch (error) {// ...\n    }\n  };\n\n  VirtualList.prototype.getSizeOf = function getSizeOf(index) {\n    var _this3 = this;\n\n    var cache = this.cache;\n    var _props2 = this.props,\n        itemSizeGetter = _props2.itemSizeGetter,\n        jumpIndex = _props2.jumpIndex; // Try the cache.\n\n    if (index in cache) {\n      return cache[index];\n    }\n\n    if (itemSizeGetter) {\n      return itemSizeGetter(index);\n    }\n\n    var height = Object.keys(this.cache).map(function (key) {\n      return _this3.cache[key];\n    }).pop();\n\n    if (!this.defaultItemHeight && jumpIndex > -1 && height) {\n      this.defaultItemHeight = height;\n    }\n\n    if (this.defaultItemHeight) {\n      return this.defaultItemHeight;\n    }\n  };\n\n  VirtualList.prototype.scrollTo = function scrollTo(index) {\n    this.setScroll(this.getSpaceBefore(index, this.cacheAdd));\n  };\n\n  VirtualList.prototype.renderMenuItems = function renderMenuItems() {\n    var _this4 = this;\n\n    var _props3 = this.props,\n        children = _props3.children,\n        itemsRenderer = _props3.itemsRenderer;\n    var _state = this.state,\n        from = _state.from,\n        size = _state.size;\n    var items = [];\n\n    for (var i = 0; i < size; ++i) {\n      items.push(children[from + i]);\n    }\n\n    return itemsRenderer(items, function (c) {\n      _this4.items = c;\n      return _this4.items;\n    });\n  };\n\n  VirtualList.prototype.render = function render() {\n    var _cx,\n        _this5 = this;\n\n    var _props4 = this.props,\n        _props4$children = _props4.children,\n        children = _props4$children === undefined ? [] : _props4$children,\n        prefix = _props4.prefix,\n        className = _props4.className;\n    var length = children.length;\n    var from = this.state.from;\n    var items = this.renderMenuItems();\n    var style = {\n      position: 'relative'\n    };\n    var size = this.getSpaceBefore(length, this.cacheAdd);\n\n    if (size) {\n      style.height = size;\n    }\n\n    var offset = this.getSpaceBefore(from, this.cacheAdd);\n    var transform = 'translate(0px, ' + offset + 'px)';\n    var listStyle = {\n      msTransform: transform,\n      WebkitTransform: transform,\n      transform: transform\n    };\n    var cls = cx((_cx = {}, _cx[prefix + 'virtual-list-wrapper'] = true, _cx[className] = !!className, _cx));\n    return React.createElement('div', {\n      className: cls,\n      style: style,\n      ref: function ref(c) {\n        _this5.el = c;\n        return _this5.el;\n      }\n    }, React.createElement('div', {\n      style: listStyle\n    }, items));\n  };\n\n  return VirtualList;\n}(Component), _class.displayName = 'VirtualList', _class.propTypes = {\n  prefix: PropTypes.string,\n\n  /**\n   * 渲染的子节点\n   */\n  children: PropTypes.any,\n\n  /**\n   * 最小加载数量\n   */\n  minSize: PropTypes.number,\n\n  /**\n   * 一屏数量\n   */\n  pageSize: PropTypes.number,\n\n  /**\n   * 父渲染函数，默认为 (items, ref) => <ul ref={ref}>{items}</ul>\n   */\n  itemsRenderer: PropTypes.func,\n\n  /**\n   * 缓冲区高度\n   */\n  threshold: PropTypes.number,\n\n  /**\n   * 获取item高度的函数\n   */\n  itemSizeGetter: PropTypes.func,\n\n  /**\n   * 设置跳转位置，需要设置 itemSizeGetter 才能生效, 不设置认为元素等高并取第一个元素高度作为默认高\n   */\n  jumpIndex: PropTypes.number,\n  className: PropTypes.string\n}, _class.defaultProps = {\n  prefix: 'next-',\n  itemsRenderer: function itemsRenderer(items, ref) {\n    return React.createElement('ul', {\n      ref: ref\n    }, items);\n  },\n  minSize: 1,\n  pageSize: 10,\n  jumpIndex: 0,\n  threshold: 100\n}, _temp);\nVirtualList.displayName = 'VirtualList';\nexport default polyfill(VirtualList);","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/node_modules/@alifd/next/es/virtual-list/virtual-list.js"],"names":["_classCallCheck","_possibleConstructorReturn","_inherits","_class","_temp","PropTypes","React","Component","cx","polyfill","findDOMNode","events","NOOP","MAX_SYNC_UPDATES","isEqualSubset","a","b","key","getOffset","el","offset","clientLeft","offsetTop","offsetParent","constrain","from","size","_ref","children","minSize","length","Math","max","min","VirtualList","_Component","props","_this","call","jumpIndex","_constrain","state","cache","cacheAdd","scrollTo","bind","cachedScroll","unstable","updateCounter","getDerivedStateFromProps","nextProps","prevState","prototype","componentDidMount","updateFrameAndClearCache","on","window","updateFrame","componentDidUpdate","prevProps","_this2","oldIndex","newIndex","updateCounterTimeoutId","setTimeout","componentWillUnmount","off","scrollParent","maybeSetState","cb","setState","getEl","items","getScrollParent","parentElement","getComputedStyle","overflowY","getScroll","scrollKey","actual","document","body","documentElement","getScrollSize","getViewportSize","scroll","setScroll","scrollTop","innerHeight","clientHeight","_document","getStartAndEnd","threshold","arguments","undefined","trueScroll","start","end","updateScrollParent","updateVariableFrame","prev","itemSizeGetter","cacheSizes","_getStartAndEnd","_props","pageSize","space","maxFrom","itemSize","getSizeOf","maxSize","_itemSize","getSpaceBefore","index","i","_items","_items$props","itemEls","l","ulRef","height","offsetHeight","error","_this3","_props2","Object","keys","map","pop","defaultItemHeight","renderMenuItems","_this4","_props3","itemsRenderer","_state","push","c","render","_cx","_this5","_props4","_props4$children","prefix","className","style","position","transform","listStyle","msTransform","WebkitTransform","cls","createElement","ref","displayName","propTypes","string","any","number","func","defaultProps"],"mappings":"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","sourcesContent":["import _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp;\n\nimport PropTypes from 'prop-types';\nimport React, { Component } from 'react';\nimport cx from 'classnames';\nimport { polyfill } from 'react-lifecycles-compat';\nimport { findDOMNode } from 'react-dom';\nimport { events } from '../util';\n\nvar NOOP = function NOOP() {};\nvar MAX_SYNC_UPDATES = 40;\n\nvar isEqualSubset = function isEqualSubset(a, b) {\n    for (var key in b) {\n        if (a[key] !== b[key]) {\n            return false;\n        }\n    }\n\n    return true;\n};\n\nvar getOffset = function getOffset(el) {\n    var offset = el.clientLeft || 0;\n    do {\n        offset += el.offsetTop || 0;\n        el = el.offsetParent;\n    } while (el);\n    return offset;\n};\n\nvar constrain = function constrain(from, size, _ref) {\n    var children = _ref.children,\n        minSize = _ref.minSize;\n\n    var length = children && children.length;\n    size = Math.max(size, minSize);\n    if (size > length) {\n        size = length;\n    }\n    from = from ? Math.max(Math.min(from, length - size), 0) : 0;\n\n    return { from: from, size: size };\n};\n/** VirtualList */\nvar VirtualList = (_temp = _class = function (_Component) {\n    _inherits(VirtualList, _Component);\n\n    function VirtualList(props) {\n        _classCallCheck(this, VirtualList);\n\n        var _this = _possibleConstructorReturn(this, _Component.call(this, props));\n\n        var jumpIndex = props.jumpIndex;\n\n        var _constrain = constrain(jumpIndex, 0, props),\n            from = _constrain.from,\n            size = _constrain.size;\n\n        _this.state = { from: from, size: size };\n        _this.cache = {};\n        _this.cacheAdd = {};\n        _this.scrollTo = _this.scrollTo.bind(_this);\n        _this.cachedScroll = null;\n        _this.unstable = false;\n        _this.updateCounter = 0;\n        return _this;\n    }\n\n    VirtualList.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n        var from = prevState.from,\n            size = prevState.size;\n\n\n        return constrain(from, size, nextProps);\n    };\n\n    VirtualList.prototype.componentDidMount = function componentDidMount() {\n        var jumpIndex = this.props.jumpIndex;\n\n\n        this.updateFrameAndClearCache = this.updateFrameAndClearCache.bind(this);\n\n        events.on(window, 'resize', this.updateFrameAndClearCache);\n\n        this.updateFrame(this.scrollTo.bind(this, jumpIndex));\n    };\n\n    VirtualList.prototype.componentDidUpdate = function componentDidUpdate(prevProps) {\n        var _this2 = this;\n\n        var oldIndex = prevProps.jumpIndex;\n        var newIndex = this.props.jumpIndex;\n\n        if (oldIndex !== newIndex) {\n            this.updateFrame(this.scrollTo.bind(this, newIndex));\n        }\n\n        // If the list has reached an unstable state, prevent an infinite loop.\n        if (this.unstable) {\n            return;\n        }\n\n        if (++this.updateCounter > MAX_SYNC_UPDATES) {\n            this.unstable = true;\n        }\n\n        if (!this.updateCounterTimeoutId) {\n            this.updateCounterTimeoutId = setTimeout(function () {\n                _this2.updateCounter = 0;\n                delete _this2.updateCounterTimeoutId;\n            }, 0);\n        }\n\n        this.updateFrame();\n    };\n\n    VirtualList.prototype.componentWillUnmount = function componentWillUnmount() {\n        events.off(window, 'resize', this.updateFrameAndClearCache);\n\n        events.off(this.scrollParent, 'scroll', this.updateFrameAndClearCache);\n        events.off(this.scrollParent, 'mousewheel', NOOP);\n    };\n\n    VirtualList.prototype.maybeSetState = function maybeSetState(b, cb) {\n        if (isEqualSubset(this.state, b)) {\n            return cb();\n        }\n\n        this.setState(b, cb);\n    };\n\n    VirtualList.prototype.getEl = function getEl() {\n        return this.el || this.items || {};\n    };\n\n    VirtualList.prototype.getScrollParent = function getScrollParent() {\n        var el = this.getEl();\n        el = el.parentElement;\n\n        switch (window.getComputedStyle(el).overflowY) {\n            case 'auto':\n            case 'scroll':\n            case 'overlay':\n            case 'visible':\n                return el;\n        }\n\n        return window;\n    };\n\n    VirtualList.prototype.getScroll = function getScroll() {\n        // Cache scroll position as this causes a forced synchronous layout.\n        // if (typeof this.cachedScroll === 'number') {\n        //     return this.cachedScroll;\n        // }\n        var scrollParent = this.scrollParent;\n\n        var scrollKey = 'scrollTop';\n        var actual = scrollParent === window ? // Firefox always returns document.body[scrollKey] as 0 and Chrome/Safari\n        // always return document.documentElement[scrollKey] as 0, so take\n        // whichever has a value.\n        document.body[scrollKey] || document.documentElement[scrollKey] : scrollParent[scrollKey];\n        var max = this.getScrollSize() - this.getViewportSize();\n\n        var scroll = Math.max(0, Math.min(actual, max));\n        var el = this.getEl();\n        this.cachedScroll = getOffset(scrollParent) + scroll - getOffset(el);\n\n        return this.cachedScroll;\n    };\n\n    VirtualList.prototype.setScroll = function setScroll(offset) {\n        var scrollParent = this.scrollParent;\n\n        offset += getOffset(this.getEl());\n        if (scrollParent === window) {\n            return window.scrollTo(0, offset);\n        }\n\n        offset -= getOffset(this.scrollParent);\n        scrollParent.scrollTop = offset;\n    };\n\n    VirtualList.prototype.getViewportSize = function getViewportSize() {\n        var scrollParent = this.scrollParent;\n\n        return scrollParent === window ? window.innerHeight : scrollParent.clientHeight;\n    };\n\n    VirtualList.prototype.getScrollSize = function getScrollSize() {\n        var scrollParent = this.scrollParent;\n        var _document = document,\n            body = _document.body,\n            documentElement = _document.documentElement;\n\n        var key = 'scrollHeight';\n        return scrollParent === window ? Math.max(body[key], documentElement[key]) : scrollParent[key];\n    };\n\n    VirtualList.prototype.getStartAndEnd = function getStartAndEnd() {\n        var threshold = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.props.threshold;\n\n        var scroll = this.getScroll();\n\n        var trueScroll = scroll;\n        var start = Math.max(0, trueScroll - threshold);\n        var end = trueScroll + this.getViewportSize() + threshold;\n\n        return { start: start, end: end };\n    };\n\n    // Called by 'scroll' and 'resize' events, clears scroll position cache.\n\n\n    VirtualList.prototype.updateFrameAndClearCache = function updateFrameAndClearCache(cb) {\n        this.cachedScroll = null;\n        return this.updateFrame(cb);\n    };\n\n    VirtualList.prototype.updateFrame = function updateFrame(cb) {\n        this.updateScrollParent();\n\n        if (typeof cb !== 'function') {\n            cb = NOOP;\n        }\n\n        return this.updateVariableFrame(cb);\n    };\n\n    VirtualList.prototype.updateScrollParent = function updateScrollParent() {\n        var prev = this.scrollParent;\n        this.scrollParent = this.getScrollParent();\n\n        if (prev === this.scrollParent) {\n            return;\n        }\n        if (prev) {\n            events.off(prev, 'scroll', this.updateFrameAndClearCache);\n            events.off(prev, 'mousewheel', NOOP);\n        }\n\n        events.on(this.scrollParent, 'scroll', this.updateFrameAndClearCache);\n        events.on(this.scrollParent, 'mousewheel', NOOP);\n\n        // You have to attach mousewheel listener to the scrollable element.\n        // Just an empty listener. After that onscroll events will be fired synchronously.\n    };\n\n    VirtualList.prototype.updateVariableFrame = function updateVariableFrame(cb) {\n        if (!this.props.itemSizeGetter) {\n            this.cacheSizes();\n        }\n\n        var _getStartAndEnd = this.getStartAndEnd(),\n            start = _getStartAndEnd.start,\n            end = _getStartAndEnd.end;\n\n        var _props = this.props,\n            pageSize = _props.pageSize,\n            children = _props.children;\n\n        var length = children.length;\n        var space = 0;\n        var from = 0;\n        var size = 0;\n        var maxFrom = length - 1;\n\n        while (from < maxFrom) {\n            var itemSize = this.getSizeOf(from);\n            if (itemSize === null || itemSize === undefined || space + itemSize > start) {\n                break;\n            }\n            space += itemSize;\n            ++from;\n        }\n\n        var maxSize = length - from;\n\n        while (size < maxSize && space < end) {\n            var _itemSize = this.getSizeOf(from + size);\n            if (_itemSize === null || _itemSize === undefined) {\n                size = Math.min(size + pageSize, maxSize);\n                break;\n            }\n            space += _itemSize;\n            ++size;\n        }\n\n        this.maybeSetState({ from: from, size: size }, cb);\n    };\n\n    VirtualList.prototype.getSpaceBefore = function getSpaceBefore(index) {\n        var cache = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n\n        if (!index) {\n            return 0;\n        }\n        if (cache[index] !== null && cache[index] !== undefined) {\n            return cache[index] || 0;\n        }\n\n        // Find the closest space to index there is a cached value for.\n        var from = index;\n        while (from > 0 && (cache[from] === null || cache[from] === undefined)) {\n            from--;\n        }\n\n        // Finally, accumulate sizes of items from - index.\n        var space = cache[from] || 0;\n        for (var i = from; i < index; ++i) {\n            cache[i] = space;\n            var itemSize = this.getSizeOf(i);\n            if (itemSize === null || itemSize === undefined) {\n                break;\n            }\n            space += itemSize;\n        }\n\n        cache[index] = space;\n\n        return cache[index] || 0;\n    };\n\n    VirtualList.prototype.cacheSizes = function cacheSizes() {\n        var cache = this.cache;\n        var from = this.state.from;\n        var _items = this.items,\n            children = _items.children,\n            _items$props = _items.props,\n            props = _items$props === undefined ? {} : _items$props;\n\n        var itemEls = children || props.children || [];\n\n        try {\n            // <Select useVirtual /> 模式下，在快速点击切换Tab的情况下（Select实例快速出现、消失） 有时会出现this.items不存在，导致页面报错。怀疑是Select的异步timer渲染逻辑引起的\n            for (var i = 0, l = itemEls.length; i < l; ++i) {\n                var ulRef = findDOMNode(this.items);\n                var height = ulRef.children[i].offsetHeight;\n                if (height > 0) {\n                    cache[from + i] = height;\n                }\n            }\n        } catch (error) {\n            // ...\n        }\n    };\n\n    VirtualList.prototype.getSizeOf = function getSizeOf(index) {\n        var _this3 = this;\n\n        var cache = this.cache;\n        var _props2 = this.props,\n            itemSizeGetter = _props2.itemSizeGetter,\n            jumpIndex = _props2.jumpIndex;\n\n        // Try the cache.\n\n        if (index in cache) {\n            return cache[index];\n        }\n        if (itemSizeGetter) {\n            return itemSizeGetter(index);\n        }\n\n        var height = Object.keys(this.cache).map(function (key) {\n            return _this3.cache[key];\n        }).pop();\n        if (!this.defaultItemHeight && jumpIndex > -1 && height) {\n            this.defaultItemHeight = height;\n        }\n\n        if (this.defaultItemHeight) {\n            return this.defaultItemHeight;\n        }\n    };\n\n    VirtualList.prototype.scrollTo = function scrollTo(index) {\n        this.setScroll(this.getSpaceBefore(index, this.cacheAdd));\n    };\n\n    VirtualList.prototype.renderMenuItems = function renderMenuItems() {\n        var _this4 = this;\n\n        var _props3 = this.props,\n            children = _props3.children,\n            itemsRenderer = _props3.itemsRenderer;\n        var _state = this.state,\n            from = _state.from,\n            size = _state.size;\n\n        var items = [];\n\n        for (var i = 0; i < size; ++i) {\n            items.push(children[from + i]);\n        }\n\n        return itemsRenderer(items, function (c) {\n            _this4.items = c;\n            return _this4.items;\n        });\n    };\n\n    VirtualList.prototype.render = function render() {\n        var _cx,\n            _this5 = this;\n\n        var _props4 = this.props,\n            _props4$children = _props4.children,\n            children = _props4$children === undefined ? [] : _props4$children,\n            prefix = _props4.prefix,\n            className = _props4.className;\n\n        var length = children.length;\n        var from = this.state.from;\n\n        var items = this.renderMenuItems();\n\n        var style = { position: 'relative' };\n\n        var size = this.getSpaceBefore(length, this.cacheAdd);\n\n        if (size) {\n            style.height = size;\n        }\n        var offset = this.getSpaceBefore(from, this.cacheAdd);\n        var transform = 'translate(0px, ' + offset + 'px)';\n        var listStyle = {\n            msTransform: transform,\n            WebkitTransform: transform,\n            transform: transform\n        };\n\n        var cls = cx((_cx = {}, _cx[prefix + 'virtual-list-wrapper'] = true, _cx[className] = !!className, _cx));\n\n        return React.createElement(\n            'div',\n            {\n                className: cls,\n                style: style,\n                ref: function ref(c) {\n                    _this5.el = c;\n                    return _this5.el;\n                }\n            },\n            React.createElement(\n                'div',\n                { style: listStyle },\n                items\n            )\n        );\n    };\n\n    return VirtualList;\n}(Component), _class.displayName = 'VirtualList', _class.propTypes = {\n    prefix: PropTypes.string,\n    /**\n     * 渲染的子节点\n     */\n    children: PropTypes.any,\n    /**\n     * 最小加载数量\n     */\n    minSize: PropTypes.number,\n    /**\n     * 一屏数量\n     */\n    pageSize: PropTypes.number,\n    /**\n     * 父渲染函数，默认为 (items, ref) => <ul ref={ref}>{items}</ul>\n     */\n    itemsRenderer: PropTypes.func,\n    /**\n     * 缓冲区高度\n     */\n    threshold: PropTypes.number,\n    /**\n     * 获取item高度的函数\n     */\n    itemSizeGetter: PropTypes.func,\n    /**\n     * 设置跳转位置，需要设置 itemSizeGetter 才能生效, 不设置认为元素等高并取第一个元素高度作为默认高\n     */\n    jumpIndex: PropTypes.number,\n    className: PropTypes.string\n}, _class.defaultProps = {\n    prefix: 'next-',\n    itemsRenderer: function itemsRenderer(items, ref) {\n        return React.createElement(\n            'ul',\n            { ref: ref },\n            items\n        );\n    },\n    minSize: 1,\n    pageSize: 10,\n    jumpIndex: 0,\n    threshold: 100\n}, _temp);\nVirtualList.displayName = 'VirtualList';\n\n\nexport default polyfill(VirtualList);"]},"metadata":{},"sourceType":"module"}