{"ast":null,"code":"import _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp, _initialiseProps;\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { polyfill } from 'react-lifecycles-compat';\nimport classnames from 'classnames';\nimport Dropdown from '../../dropdown';\nimport Menu from '../../menu';\nimport Button from '../../button';\nimport Icon from '../../icon';\nimport { KEYCODE } from '../../util'; // 共享状态的组件需要变成非受控组件\n\nvar Filter = (_temp = _class = function (_React$Component) {\n  _inherits(Filter, _React$Component);\n\n  function Filter(props) {\n    _classCallCheck(this, Filter);\n\n    var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n    _initialiseProps.call(_this);\n\n    var filterParams = props.filterParams || {};\n    var filterConfig = filterParams[props.dataIndex] || {};\n    _this.state = {\n      visible: filterConfig.visible || false,\n      selectedKeys: filterConfig.selectedKeys || [],\n      selectedKeysChangedByInner: true\n    };\n    _this._selectedKeys = [].concat(_this.state.selectedKeys);\n    return _this;\n  }\n\n  Filter.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n    var state = {};\n\n    if (nextProps.hasOwnProperty('filterParams') && typeof nextProps.filterParams !== 'undefined') {\n      var dataIndex = nextProps.dataIndex || this.props.dataIndex;\n      var filterParams = nextProps.filterParams || {};\n      var filterConfig = filterParams[dataIndex] || {};\n      var selectedKeys = void 0;\n\n      if (prevState.selectedKeysChangedByInner) {\n        selectedKeys = prevState.selectedKeys || [];\n        state.selectedKeysChangedByInner = false;\n      } else {\n        selectedKeys = filterConfig.selectedKeys || [];\n      }\n\n      state.selectedKeys = selectedKeys;\n    }\n\n    return state;\n  };\n\n  Filter.prototype.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n    var selectedKeys = prevState.selectedKeys;\n    this._selectedKeys = [].concat(selectedKeys);\n  };\n\n  Filter.prototype.render = function render() {\n    var _classnames, _classnames2, _classnames3;\n\n    var _props = this.props,\n        filters = _props.filters,\n        prefix = _props.prefix,\n        locale = _props.locale,\n        className = _props.className,\n        filterMode = _props.filterMode,\n        filterMenuProps = _props.filterMenuProps,\n        filterProps = _props.filterProps,\n        rtl = _props.rtl;\n    var dropdownClassname = classnames(filterProps && filterProps.className, (_classnames = {}, _classnames[prefix + 'table-filter-menu'] = true, _classnames));\n    var _state = this.state,\n        visible = _state.visible,\n        selectedKeys = _state.selectedKeys;\n\n    var _ref = filterMenuProps || {},\n        subMenuSelectable = _ref.subMenuSelectable,\n        others = _objectWithoutProperties(_ref, ['subMenuSelectable']);\n\n    function renderMenuItem(item) {\n      return React.createElement(Menu.Item, {\n        key: item.value\n      }, item.label);\n    }\n\n    function renderSubMenu(parent, children) {\n      return React.createElement(Menu.SubMenu, {\n        label: parent.label,\n        key: parent.value,\n        selectable: subMenuSelectable\n      }, renderMenuContent(children));\n    }\n\n    function renderMenuContent(list) {\n      return list.map(function (item) {\n        if (item.children) {\n          return renderSubMenu(item, item.children);\n        } else {\n          return renderMenuItem(item);\n        }\n      });\n    }\n\n    var content = renderMenuContent(filters),\n        footer = React.createElement('div', {\n      className: prefix + 'table-filter-footer'\n    }, React.createElement(Button, {\n      type: 'primary',\n      onClick: this.onFilterConfirm\n    }, locale.ok), React.createElement(Button, {\n      onClick: this.onFilterClear\n    }, locale.reset));\n    var cls = classnames((_classnames2 = {}, _classnames2[prefix + 'table-filter'] = true, _classnames2[className] = className, _classnames2));\n    var filterIconCls = classnames((_classnames3 = {}, _classnames3[prefix + 'table-filter-active'] = selectedKeys && selectedKeys.length > 0, _classnames3));\n    return React.createElement(Dropdown, _extends({\n      trigger: React.createElement('span', {\n        role: 'button',\n        'aria-label': locale.filter,\n        onKeyDown: this.filterKeydown,\n        tabIndex: '0',\n        className: cls\n      }, React.createElement(Icon, {\n        type: 'filter',\n        size: 'small',\n        className: filterIconCls\n      })),\n      triggerType: 'click',\n      visible: visible,\n      autoFocus: true,\n      rtl: rtl,\n      needAdjust: false,\n      onVisibleChange: this.onFilterVisible,\n      className: dropdownClassname\n    }, filterProps), React.createElement(Menu, _extends({\n      footer: footer,\n      rtl: rtl,\n      selectedKeys: selectedKeys,\n      selectMode: filterMode,\n      onSelect: this.onFilterSelect\n    }, others), content));\n  };\n\n  return Filter;\n}(React.Component), _class.propTypes = {\n  dataIndex: PropTypes.string,\n  filters: PropTypes.array,\n  filterMode: PropTypes.string,\n  filterParams: PropTypes.object,\n  filterMenuProps: PropTypes.object,\n  filterProps: PropTypes.object,\n  locale: PropTypes.object,\n  onFilter: PropTypes.func,\n  prefix: PropTypes.string,\n  rtl: PropTypes.bool\n}, _class.defaultProps = {\n  onFilter: function onFilter() {}\n}, _initialiseProps = function _initialiseProps() {\n  var _this2 = this;\n\n  this.filterKeydown = function (e) {\n    e.preventDefault();\n    e.stopPropagation();\n\n    if (e.keyCode === KEYCODE.ENTER) {\n      _this2.setState({\n        visible: !_this2.state.visible\n      });\n    }\n  };\n\n  this.onFilterVisible = function (visible) {\n    _this2.setState({\n      visible: visible\n    });\n\n    if (!visible) {\n      var selectedKeys = [].concat(_this2._selectedKeys);\n\n      _this2.setState({\n        selectedKeysChangedByInner: true,\n        selectedKeys: selectedKeys\n      });\n    }\n  };\n\n  this.onFilterSelect = function (selectedKeys) {\n    _this2.setState({\n      visible: true,\n      selectedKeysChangedByInner: true,\n      selectedKeys: selectedKeys\n    });\n  };\n\n  this.onFilterConfirm = function () {\n    var selectedKeys = _this2.state.selectedKeys;\n    var filterParams = {},\n        dataIndex = _this2.props.dataIndex;\n    filterParams[dataIndex] = {\n      visible: false,\n      selectedKeys: selectedKeys\n    };\n    _this2._selectedKeys = [].concat(selectedKeys);\n\n    _this2.setState({\n      visible: false,\n      selectedKeysChangedByInner: true\n    }); // 兼容之前的格式\n\n\n    _this2.props.onFilter(filterParams);\n  };\n\n  this.onFilterClear = function () {\n    var filterParams = {},\n        dataIndex = _this2.props.dataIndex;\n    filterParams[dataIndex] = {\n      visible: false,\n      selectedKeys: []\n    };\n    _this2._selectedKeys = [];\n\n    _this2.setState({\n      selectedKeys: [],\n      visible: false,\n      selectedKeysChangedByInner: true\n    }); // 兼容之前的格式\n\n\n    _this2.props.onFilter(filterParams);\n  };\n}, _temp);\nFilter.displayName = 'Filter';\nexport default polyfill(Filter);","map":{"version":3,"sources":["/Users/Chris/Project/lunch-order-backstage/node_modules/@alifd/next/es/table/base/filter.js"],"names":["_extends","_objectWithoutProperties","_classCallCheck","_possibleConstructorReturn","_inherits","_class","_temp","_initialiseProps","React","PropTypes","polyfill","classnames","Dropdown","Menu","Button","Icon","KEYCODE","Filter","_React$Component","props","_this","call","filterParams","filterConfig","dataIndex","state","visible","selectedKeys","selectedKeysChangedByInner","_selectedKeys","concat","getDerivedStateFromProps","nextProps","prevState","hasOwnProperty","prototype","componentDidUpdate","prevProps","render","_classnames","_classnames2","_classnames3","_props","filters","prefix","locale","className","filterMode","filterMenuProps","filterProps","rtl","dropdownClassname","_state","_ref","subMenuSelectable","others","renderMenuItem","item","createElement","Item","key","value","label","renderSubMenu","parent","children","SubMenu","selectable","renderMenuContent","list","map","content","footer","type","onClick","onFilterConfirm","ok","onFilterClear","reset","cls","filterIconCls","length","trigger","role","filter","onKeyDown","filterKeydown","tabIndex","size","triggerType","autoFocus","needAdjust","onVisibleChange","onFilterVisible","selectMode","onSelect","onFilterSelect","Component","propTypes","string","array","object","onFilter","func","bool","defaultProps","_this2","e","preventDefault","stopPropagation","keyCode","ENTER","setState","displayName"],"mappings":"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","sourcesContent":["import _extends from 'babel-runtime/helpers/extends';\nimport _objectWithoutProperties from 'babel-runtime/helpers/objectWithoutProperties';\nimport _classCallCheck from 'babel-runtime/helpers/classCallCheck';\nimport _possibleConstructorReturn from 'babel-runtime/helpers/possibleConstructorReturn';\nimport _inherits from 'babel-runtime/helpers/inherits';\n\nvar _class, _temp, _initialiseProps;\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { polyfill } from 'react-lifecycles-compat';\nimport classnames from 'classnames';\nimport Dropdown from '../../dropdown';\nimport Menu from '../../menu';\nimport Button from '../../button';\nimport Icon from '../../icon';\nimport { KEYCODE } from '../../util';\n\n// 共享状态的组件需要变成非受控组件\nvar Filter = (_temp = _class = function (_React$Component) {\n    _inherits(Filter, _React$Component);\n\n    function Filter(props) {\n        _classCallCheck(this, Filter);\n\n        var _this = _possibleConstructorReturn(this, _React$Component.call(this, props));\n\n        _initialiseProps.call(_this);\n\n        var filterParams = props.filterParams || {};\n        var filterConfig = filterParams[props.dataIndex] || {};\n        _this.state = {\n            visible: filterConfig.visible || false,\n            selectedKeys: filterConfig.selectedKeys || [],\n            selectedKeysChangedByInner: true\n        };\n        _this._selectedKeys = [].concat(_this.state.selectedKeys);\n        return _this;\n    }\n\n    Filter.getDerivedStateFromProps = function getDerivedStateFromProps(nextProps, prevState) {\n        var state = {};\n        if (nextProps.hasOwnProperty('filterParams') && typeof nextProps.filterParams !== 'undefined') {\n            var dataIndex = nextProps.dataIndex || this.props.dataIndex;\n            var filterParams = nextProps.filterParams || {};\n            var filterConfig = filterParams[dataIndex] || {};\n            var selectedKeys = void 0;\n            if (prevState.selectedKeysChangedByInner) {\n                selectedKeys = prevState.selectedKeys || [];\n                state.selectedKeysChangedByInner = false;\n            } else {\n                selectedKeys = filterConfig.selectedKeys || [];\n            }\n\n            state.selectedKeys = selectedKeys;\n        }\n\n        return state;\n    };\n\n    Filter.prototype.componentDidUpdate = function componentDidUpdate(prevProps, prevState) {\n        var selectedKeys = prevState.selectedKeys;\n\n        this._selectedKeys = [].concat(selectedKeys);\n    };\n\n    Filter.prototype.render = function render() {\n        var _classnames, _classnames2, _classnames3;\n\n        var _props = this.props,\n            filters = _props.filters,\n            prefix = _props.prefix,\n            locale = _props.locale,\n            className = _props.className,\n            filterMode = _props.filterMode,\n            filterMenuProps = _props.filterMenuProps,\n            filterProps = _props.filterProps,\n            rtl = _props.rtl;\n\n\n        var dropdownClassname = classnames(filterProps && filterProps.className, (_classnames = {}, _classnames[prefix + 'table-filter-menu'] = true, _classnames));\n        var _state = this.state,\n            visible = _state.visible,\n            selectedKeys = _state.selectedKeys;\n\n        var _ref = filterMenuProps || {},\n            subMenuSelectable = _ref.subMenuSelectable,\n            others = _objectWithoutProperties(_ref, ['subMenuSelectable']);\n\n        function renderMenuItem(item) {\n            return React.createElement(\n                Menu.Item,\n                { key: item.value },\n                item.label\n            );\n        }\n\n        function renderSubMenu(parent, children) {\n            return React.createElement(\n                Menu.SubMenu,\n                { label: parent.label, key: parent.value, selectable: subMenuSelectable },\n                renderMenuContent(children)\n            );\n        }\n\n        function renderMenuContent(list) {\n            return list.map(function (item) {\n                if (item.children) {\n                    return renderSubMenu(item, item.children);\n                } else {\n                    return renderMenuItem(item);\n                }\n            });\n        }\n\n        var content = renderMenuContent(filters),\n            footer = React.createElement(\n            'div',\n            { className: prefix + 'table-filter-footer' },\n            React.createElement(\n                Button,\n                { type: 'primary', onClick: this.onFilterConfirm },\n                locale.ok\n            ),\n            React.createElement(\n                Button,\n                { onClick: this.onFilterClear },\n                locale.reset\n            )\n        );\n\n        var cls = classnames((_classnames2 = {}, _classnames2[prefix + 'table-filter'] = true, _classnames2[className] = className, _classnames2));\n\n        var filterIconCls = classnames((_classnames3 = {}, _classnames3[prefix + 'table-filter-active'] = selectedKeys && selectedKeys.length > 0, _classnames3));\n\n        return React.createElement(\n            Dropdown,\n            _extends({\n                trigger: React.createElement(\n                    'span',\n                    {\n                        role: 'button',\n                        'aria-label': locale.filter,\n                        onKeyDown: this.filterKeydown,\n                        tabIndex: '0',\n                        className: cls\n                    },\n                    React.createElement(Icon, { type: 'filter', size: 'small', className: filterIconCls })\n                ),\n                triggerType: 'click',\n                visible: visible,\n                autoFocus: true,\n                rtl: rtl,\n                needAdjust: false,\n                onVisibleChange: this.onFilterVisible,\n                className: dropdownClassname\n            }, filterProps),\n            React.createElement(\n                Menu,\n                _extends({\n                    footer: footer,\n                    rtl: rtl,\n                    selectedKeys: selectedKeys,\n                    selectMode: filterMode,\n                    onSelect: this.onFilterSelect\n                }, others),\n                content\n            )\n        );\n    };\n\n    return Filter;\n}(React.Component), _class.propTypes = {\n    dataIndex: PropTypes.string,\n    filters: PropTypes.array,\n    filterMode: PropTypes.string,\n    filterParams: PropTypes.object,\n    filterMenuProps: PropTypes.object,\n    filterProps: PropTypes.object,\n    locale: PropTypes.object,\n    onFilter: PropTypes.func,\n    prefix: PropTypes.string,\n    rtl: PropTypes.bool\n}, _class.defaultProps = {\n    onFilter: function onFilter() {}\n}, _initialiseProps = function _initialiseProps() {\n    var _this2 = this;\n\n    this.filterKeydown = function (e) {\n        e.preventDefault();\n        e.stopPropagation();\n\n        if (e.keyCode === KEYCODE.ENTER) {\n            _this2.setState({\n                visible: !_this2.state.visible\n            });\n        }\n    };\n\n    this.onFilterVisible = function (visible) {\n        _this2.setState({\n            visible: visible\n        });\n\n        if (!visible) {\n            var selectedKeys = [].concat(_this2._selectedKeys);\n\n            _this2.setState({\n                selectedKeysChangedByInner: true,\n                selectedKeys: selectedKeys\n            });\n        }\n    };\n\n    this.onFilterSelect = function (selectedKeys) {\n        _this2.setState({\n            visible: true,\n            selectedKeysChangedByInner: true,\n            selectedKeys: selectedKeys\n        });\n    };\n\n    this.onFilterConfirm = function () {\n        var selectedKeys = _this2.state.selectedKeys;\n        var filterParams = {},\n            dataIndex = _this2.props.dataIndex;\n\n\n        filterParams[dataIndex] = {\n            visible: false,\n            selectedKeys: selectedKeys\n        };\n        _this2._selectedKeys = [].concat(selectedKeys);\n        _this2.setState({\n            visible: false,\n            selectedKeysChangedByInner: true\n        });\n        // 兼容之前的格式\n        _this2.props.onFilter(filterParams);\n    };\n\n    this.onFilterClear = function () {\n        var filterParams = {},\n            dataIndex = _this2.props.dataIndex;\n\n\n        filterParams[dataIndex] = {\n            visible: false,\n            selectedKeys: []\n        };\n        _this2._selectedKeys = [];\n        _this2.setState({\n            selectedKeys: [],\n            visible: false,\n            selectedKeysChangedByInner: true\n        });\n        // 兼容之前的格式\n        _this2.props.onFilter(filterParams);\n    };\n}, _temp);\nFilter.displayName = 'Filter';\n\n\nexport default polyfill(Filter);"]},"metadata":{},"sourceType":"module"}